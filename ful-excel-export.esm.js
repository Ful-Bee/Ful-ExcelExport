function t(t){return t.map(function(t){return String.fromCharCode(90^t)}).join("")}var e=Uint8Array,n=Uint16Array,r=Int32Array,i=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=function(t,e){for(var i=new n(31),s=0;s<31;++s)i[s]=e+=1<<t[s-1];var o=new r(i[30]);for(s=1;s<30;++s)for(var l=i[s];l<i[s+1];++l)o[l]=l-i[s]<<5|s;return{b:i,r:o}},h=l(i,2),a=h.b,u=h.r;a[28]=258,u[258]=28;for(var c=l(s,0).r,f=new n(32768),d=0;d<32768;++d){var m=(43690&d)>>1|(21845&d)<<1;m=(61680&(m=(52428&m)>>2|(13107&m)<<2))>>4|(3855&m)<<4,f[d]=((65280&m)>>8|(255&m)<<8)>>1}var g=function(t,e,r){for(var i=t.length,s=0,o=new n(e);s<i;++s)t[s]&&++o[t[s]-1];var l,h=new n(e);for(s=1;s<e;++s)h[s]=h[s-1]+o[s-1]<<1;if(r){l=new n(1<<e);var a=15-e;for(s=0;s<i;++s)if(t[s])for(var u=s<<4|t[s],c=e-t[s],d=h[t[s]-1]++<<c,m=d|(1<<c)-1;d<=m;++d)l[f[d]>>a]=u}else for(l=new n(i),s=0;s<i;++s)t[s]&&(l[s]=f[h[t[s]-1]++]>>15-t[s]);return l},w=new e(288);for(d=0;d<144;++d)w[d]=8;for(d=144;d<256;++d)w[d]=9;for(d=256;d<280;++d)w[d]=7;for(d=280;d<288;++d)w[d]=8;var x=new e(32);for(d=0;d<32;++d)x[d]=5;var v=g(w,9,0),p=g(x,5,0),y=function(t){return(t+7)/8|0},$=function(t,n,r){return(null==n||n<0)&&(n=0),(null==r||r>t.length)&&(r=t.length),new e(t.subarray(n,r))},_=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],C=function(t,e,n){var r=new Error(e||_[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,C),!n)throw r;return r},b=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8},T=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8,t[r+2]|=n>>16},F=function(t,r){for(var i=[],s=0;s<t.length;++s)t[s]&&i.push({s:s,f:t[s]});var o=i.length,l=i.slice();if(!o)return{t:N,l:0};if(1==o){var h=new e(i[0].s+1);return h[i[0].s]=1,{t:h,l:1}}i.sort(function(t,e){return t.f-e.f}),i.push({s:-1,f:25001});var a=i[0],u=i[1],c=0,f=1,d=2;for(i[0]={s:-1,f:a.f+u.f,l:a,r:u};f!=o-1;)a=i[i[c].f<i[d].f?c++:d++],u=i[c!=f&&i[c].f<i[d].f?c++:d++],i[f++]={s:-1,f:a.f+u.f,l:a,r:u};var m=l[0].s;for(s=1;s<o;++s)l[s].s>m&&(m=l[s].s);var g=new n(m+1),w=M(i[f-1],g,0);if(w>r){s=0;var x=0,v=w-r,p=1<<v;for(l.sort(function(t,e){return g[e.s]-g[t.s]||t.f-e.f});s<o;++s){var y=l[s].s;if(!(g[y]>r))break;x+=p-(1<<w-g[y]),g[y]=r}for(x>>=v;x>0;){var $=l[s].s;g[$]<r?x-=1<<r-g[$]++-1:++s}for(;s>=0&&x;--s){var _=l[s].s;g[_]==r&&(--g[_],++x)}w=r}return{t:new e(g),l:w}},M=function(t,e,n){return-1==t.s?Math.max(M(t.l,e,n+1),M(t.r,e,n+1)):e[t.s]=n},S=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new n(++e),i=0,s=t[0],o=1,l=function(t){r[i++]=t},h=1;h<=e;++h)if(t[h]==s&&h!=e)++o;else{if(!s&&o>2){for(;o>138;o-=138)l(32754);o>2&&(l(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(l(s),--o;o>6;o-=6)l(8304);o>2&&(l(o-3<<5|8208),o=0)}for(;o--;)l(s);o=1,s=t[h]}return{c:r.subarray(0,i),n:e}},I=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},k=function(t,e,n){var r=n.length,i=y(e+2);t[i]=255&r,t[i+1]=r>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var s=0;s<r;++s)t[i+s+4]=n[s];return 8*(i+4+r)},R=function(t,e,r,l,h,a,u,c,f,d,m){b(e,m++,r),++h[256];for(var y=F(h,15),$=y.t,_=y.l,C=F(a,15),M=C.t,R=C.l,A=S($),N=A.c,P=A.n,E=S(M),U=E.c,D=E.n,O=new n(19),z=0;z<N.length;++z)++O[31&N[z]];for(z=0;z<U.length;++z)++O[31&U[z]];for(var W=F(O,7),X=W.t,j=W.l,B=19;B>4&&!X[o[B-1]];--B);var H,q,G,L,V=d+5<<3,J=I(h,w)+I(a,x)+u,K=I(h,$)+I(a,M)+u+14+3*B+I(O,X)+2*O[16]+3*O[17]+7*O[18];if(f>=0&&V<=J&&V<=K)return k(e,m,t.subarray(f,f+d));if(b(e,m,1+(K<J)),m+=2,K<J){H=g($,_,0),q=$,G=g(M,R,0),L=M;var Q=g(X,j,0);for(b(e,m,P-257),b(e,m+5,D-1),b(e,m+10,B-4),m+=14,z=0;z<B;++z)b(e,m+3*z,X[o[z]]);m+=3*B;for(var Y=[N,U],Z=0;Z<2;++Z){var tt=Y[Z];for(z=0;z<tt.length;++z){var et=31&tt[z];b(e,m,Q[et]),m+=X[et],et>15&&(b(e,m,tt[z]>>5&127),m+=tt[z]>>12)}}}else H=v,q=w,G=p,L=x;for(z=0;z<c;++z){var nt=l[z];if(nt>255){T(e,m,H[257+(et=nt>>18&31)]),m+=q[et+257],et>7&&(b(e,m,nt>>23&31),m+=i[et]);var rt=31&nt;T(e,m,G[rt]),m+=L[rt],rt>3&&(T(e,m,nt>>5&8191),m+=s[rt])}else T(e,m,H[nt]),m+=q[nt]}return T(e,m,H[256]),m+q[256]},A=new r([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),N=new e(0),P=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(1&n&&-306674912)^n>>>1;t[e]=n}return t}(),E=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},U=function(){function t(t,n){if("function"==typeof t&&(n=t,t={}),this.ondata=n,this.o=t||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new e(98304),this.o.dictionary){var r=this.o.dictionary.subarray(-32768);this.b.set(r,32768-r.length),this.s.i=32768-r.length}}return t.prototype.p=function(t,o){this.ondata(function(t,o,l,h,a){if(!a&&(a={l:1},o.dictionary)){var f=o.dictionary.subarray(-32768),d=new e(f.length+t.length);d.set(f),d.set(t,f.length),t=d,a.w=f.length}return function(t,o,l,h,a,f){var d=f.z||t.length,m=new e(h+d+5*(1+Math.ceil(d/7e3))+a),g=m.subarray(h,m.length-a),w=f.l,x=7&(f.r||0);if(o){x&&(g[0]=f.r>>3);for(var v=A[o-1],p=v>>13,_=8191&v,C=(1<<l)-1,b=f.p||new n(32768),T=f.h||new n(C+1),F=Math.ceil(l/3),M=2*F,S=function(e){return(t[e]^t[e+1]<<F^t[e+2]<<M)&C},I=new r(25e3),N=new n(288),P=new n(32),E=0,U=0,D=f.i||0,O=0,z=f.w||0,W=0;D+2<d;++D){var X=S(D),j=32767&D,B=T[X];if(b[j]=B,T[X]=j,z<=D){var H=d-D;if((E>7e3||O>24576)&&(H>423||!w)){x=R(t,g,0,I,N,P,U,O,W,D-W,x),O=E=U=0,W=D;for(var q=0;q<286;++q)N[q]=0;for(q=0;q<30;++q)P[q]=0}var G=2,L=0,V=_,J=j-B&32767;if(H>2&&X==S(D-J))for(var K=Math.min(p,H)-1,Q=Math.min(32767,D),Y=Math.min(258,H);J<=Q&&--V&&j!=B;){if(t[D+G]==t[D+G-J]){for(var Z=0;Z<Y&&t[D+Z]==t[D+Z-J];++Z);if(Z>G){if(G=Z,L=J,Z>K)break;var tt=Math.min(J,Z-2),et=0;for(q=0;q<tt;++q){var nt=D-J+q&32767,rt=nt-b[nt]&32767;rt>et&&(et=rt,B=nt)}}}J+=(j=B)-(B=b[j])&32767}if(L){I[O++]=268435456|u[G]<<18|c[L];var it=31&u[G],st=31&c[L];U+=i[it]+s[st],++N[257+it],++P[st],z=D+G,++E}else I[O++]=t[D],++N[t[D]]}}for(D=Math.max(D,z);D<d;++D)I[O++]=t[D],++N[t[D]];x=R(t,g,w,I,N,P,U,O,W,D-W,x),w||(f.r=7&x|g[x/8|0]<<3,x-=7,f.h=T,f.p=b,f.i=D,f.w=z)}else{for(D=f.w||0;D<d+w;D+=65535){var ot=D+65535;ot>=d&&(g[x/8|0]=w,ot=d),x=k(g,x+1,t.subarray(D,ot))}f.i=d}return $(m,0,h+y(x)+a)}(t,null==o.level?6:o.level,null==o.mem?a.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):20:12+o.mem,l,h,a)}(t,this.o,0,0,this.s),o)},t.prototype.push=function(t,n){this.ondata||C(5),this.s.l&&C(4);var r=t.length+this.s.z;if(r>this.b.length){if(r>2*this.b.length-32768){var i=new e(-32768&r);i.set(this.b.subarray(0,this.s.z)),this.b=i}var s=this.b.length-this.s.z;this.b.set(t.subarray(0,s),this.s.z),this.s.z=this.b.length,this.p(this.b,!1),this.b.set(this.b.subarray(-32768)),this.b.set(t.subarray(s),32768),this.s.z=t.length-s+32768,this.s.i=32766,this.s.w=32768}else this.b.set(t,this.s.z),this.s.z+=t.length;this.s.l=1&n,(this.s.z>this.s.w+8191||n)&&(this.p(this.b,n||!1),this.s.w=this.s.i,this.s.i-=2)},t.prototype.flush=function(){this.ondata||C(5),this.s.l&&C(4),this.p(this.b,!1),this.s.w=this.s.i,this.s.i-=2},t}(),D="undefined"!=typeof TextEncoder&&new TextEncoder,O="undefined"!=typeof TextDecoder&&new TextDecoder;try{O.decode(N,{stream:!0})}catch(t){}function z(t,n){if(n){for(var r=new e(t.length),i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}if(D)return D.encode(t);var s=t.length,o=new e(t.length+(t.length>>1)),l=0,h=function(t){o[l++]=t};for(i=0;i<s;++i){if(l+5>o.length){var a=new e(l+8+(s-i<<1));a.set(o),o=a}var u=t.charCodeAt(i);u<128||n?h(u):u<2048?(h(192|u>>6),h(128|63&u)):u>55295&&u<57344?(h(240|(u=65536+(1047552&u)|1023&t.charCodeAt(++i))>>18),h(128|u>>12&63),h(128|u>>6&63),h(128|63&u)):(h(224|u>>12),h(128|u>>6&63),h(128|63&u))}return $(o,0,l)}var W=function(t){var e=0;if(t)for(var n in t){var r=t[n].length;r>65535&&C(9),e+=r+4}return e},X=function(t,e,n,r,i,s,o,l){var h=r.length,a=n.extra,u=l&&l.length,c=W(a);E(t,e,null!=o?33639248:67324752),e+=4,null!=o&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(s<0&&8),t[e++]=i&&8,t[e++]=255&n.compression,t[e++]=n.compression>>8;var f=new Date(null==n.mtime?Date.now():n.mtime),d=f.getFullYear()-1980;if((d<0||d>119)&&C(10),E(t,e,d<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>1),e+=4,-1!=s&&(E(t,e,n.crc),E(t,e+4,s<0?-s-2:s),E(t,e+8,n.size)),E(t,e+12,h),E(t,e+14,c),e+=16,null!=o&&(E(t,e,u),E(t,e+6,n.attrs),E(t,e+10,o),e+=14),t.set(r,e),e+=h,c)for(var m in a){var g=a[m],w=g.length;E(t,e,+m),E(t,e+2,w),t.set(g,e+4),e+=4+w}return u&&(t.set(l,e),e+=u),e},j=function(){function t(t){var e;this.filename=t,this.c=(e=-1,{p:function(t){for(var n=e,r=0;r<t.length;++r)n=P[255&n^t[r]]^n>>>8;e=n},d:function(){return~e}}),this.size=0,this.compression=0}return t.prototype.process=function(t,e){this.ondata(null,t,e)},t.prototype.push=function(t,e){this.ondata||C(5),this.c.p(t),this.size+=t.length,e&&(this.crc=this.c.d()),this.process(t,e||!1)},t}(),B=function(){function t(t,e){var n,r=this;e||(e={}),j.call(this,t),this.d=new U(e,function(t,e){r.ondata(null,t,e)}),this.compression=8,this.flag=1==(n=e.level)?3:n<6?2:9==n?1:0}return t.prototype.process=function(t,e){try{this.d.push(t,e)}catch(t){this.ondata(t,null,e)}},t.prototype.push=function(t,e){j.prototype.push.call(this,t,e)},t}(),H=function(){function t(t){this.ondata=t,this.u=[],this.d=1}return t.prototype.add=function(t){var n=this;if(this.ondata||C(5),2&this.d)this.ondata(C(4+8*(1&this.d),0,1),null,!1);else{var r=z(t.filename),i=r.length,s=t.comment,o=s&&z(s),l=i!=t.filename.length||o&&s.length!=o.length,h=i+W(t.extra)+30;i>65535&&this.ondata(C(11,0,1),null,!1);var a=new e(h);X(a,0,t,r,l,-1);var u=[a],c=function(){for(var t=0,e=u;t<e.length;t++){var r=e[t];n.ondata(null,r,!1)}u=[]},f=this.d;this.d=0;var d=this.u.length,m=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n}(t,{f:r,u:l,o:o,t:function(){t.terminate&&t.terminate()},r:function(){if(c(),f){var t=n.u[d+1];t?t.r():n.d=1}f=1}}),g=0;t.ondata=function(r,i,s){if(r)n.ondata(r,i,s),n.terminate();else if(g+=i.length,u.push(i),s){var o=new e(16);E(o,0,134695760),E(o,4,t.crc),E(o,8,g),E(o,12,t.size),u.push(o),m.c=g,m.b=h+g+16,m.crc=t.crc,m.size=t.size,f&&m.r(),f=1}else f&&c()},this.u.push(m)}},t.prototype.end=function(){var t=this;2&this.d?this.ondata(C(4+8*(1&this.d),0,1),null,!0):(this.d?this.e():this.u.push({r:function(){1&t.d&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3)},t.prototype.e=function(){for(var t=0,n=0,r=0,i=0,s=this.u;i<s.length;i++)r+=46+(m=s[i]).f.length+W(m.extra)+(m.o?m.o.length:0);for(var o,l,h,a,u,c=new e(r+22),f=0,d=this.u;f<d.length;f++){var m=d[f];X(c,t,m,m.f,m.u,-m.c-2,n,m.o),t+=46+m.f.length+W(m.extra)+(m.o?m.o.length:0),n+=m.b}o=c,l=t,h=this.u.length,a=r,u=n,E(o,l,101010256),E(o,l+8,h),E(o,l+10,h),E(o,l+12,a),E(o,l+16,u),this.ondata(null,c,!0),this.d=2},t.prototype.terminate=function(){for(var t=0,e=this.u;t<e.length;t++)e[t].t();this.d=2},t}();const q="object"==typeof window?window:globalThis;let G=null,L=!1;const V=q.WebStreamsPolyfill||{},J=q.isSecureContext;let K=!0;const Q=J||"undefined"!=typeof document&&"MozAppearance"in document.documentElement.style?"iframe":"navigate",Y={createWriteStream:function(t,e,n){let r={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},i=0,s=null,o=null,l=null;if(Number.isFinite(e)?([n,e]=[e,n],r.size=n,r.writableStrategy=e):e&&e.highWaterMark?(r.size=n,r.writableStrategy=e):r=e||{},!K){G||(G=J?Z(Y.mitm):function(t){const e=document.createDocumentFragment(),n={frame:q.open(t,"popup","width=200,height=100"),loaded:!1,isIframe:!1,isPopup:!0,remove(){n.frame.close()},addEventListener(...t){e.addEventListener(...t)},dispatchEvent(...t){e.dispatchEvent(...t)},removeEventListener(...t){e.removeEventListener(...t)},postMessage(...t){n.frame.postMessage(...t)}},r=t=>{t.source===n.frame&&(n.loaded=!0,q.removeEventListener("message",r),n.dispatchEvent(new Event("load")))};return q.addEventListener("message",r),n}(Y.mitm)),o=new MessageChannel,t=encodeURIComponent(t.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const e={transferringReadable:L,pathname:r.pathname||Math.random().toString().slice(-6)+"/"+t,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+t}};r.size&&(e.headers["Content-Length"]=r.size);const n=[e,"*",[o.port2]];if(L){const t="iframe"===Q?void 0:{transform(t,e){if(!(t instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");i+=t.length,e.enqueue(t),s&&(location.href=s,s=null)},flush(){s&&(location.href=s)}};l=new Y.TransformStream(t,r.writableStrategy,r.readableStrategy);const e=l.readable;o.port1.postMessage({readableStream:e},[e])}o.port1.onmessage=t=>{t.data.download?"navigate"===Q?(G.remove(),G=null,i?location.href=t.data.download:s=t.data.download):(G.isPopup&&(G.remove(),G=null,"iframe"===Q&&Z(Y.mitm)),Z(t.data.download)):t.data.abort&&(h=[],o.port1.postMessage("abort"),o.port1.onmessage=null,o.port1.close(),o.port2.close(),o=null)},G.loaded?G.postMessage(...n):G.addEventListener("load",()=>{G.postMessage(...n)},{once:!0})}let h=[];return!K&&l&&l.writable||new Y.WritableStream({write(t){if(!(t instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");K?h.push(t):(o.port1.postMessage(t),i+=t.length,s&&(location.href=s,s=null))},close(){if(K){const e=new Blob(h,{type:"application/octet-stream; charset=utf-8"}),n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,n.click()}else o.port1.postMessage("end")},abort(){h=[],o.port1.postMessage("abort"),o.port1.onmessage=null,o.port1.close(),o.port2.close(),o=null}},r.writableStrategy)},WritableStream:q.WritableStream||V.WritableStream,supported:!0,version:{full:"2.0.6",major:2,minor:0,dot:6},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0",configure(t={}){!0===t.useStreamDownload?(K=!1,t.streamMitmUrl&&(this.mitm=t.streamMitmUrl)):K=!0}};function Z(t){if(!t)throw new Error("meh");const e=document.createElement("iframe");return e.hidden=!0,e.src=t,e.loaded=!1,e.name="iframe",e.isIframe=!0,e.postMessage=(...t)=>e.contentWindow.postMessage(...t),e.addEventListener("load",()=>{e.loaded=!0},{once:!0}),document.body.appendChild(e),e}try{new Response(new ReadableStream),J&&!("serviceWorker"in navigator)&&(K=!0)}catch(C){K=!0}(()=>{try{(()=>{const{readable:t}=new TransformStream,e=new MessageChannel;e.port1.postMessage(t,[t]),e.port1.close(),e.port2.close(),L=!0,Object.defineProperty(Y,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})})()}catch(t){}})();var tt=Y;const et=1e7,nt={cache:{},numToCol(t){if(this.cache[t])return this.cache[t];let e="",n=t;for(;n>0;)n--,e=String.fromCharCode(65+n%26)+e,n=Math.floor(n/26);return this.cache[t]=e,e},encodeAddress(t,e){return this.numToCol(e)+t}};function rt(t){return"string"!=typeof t?String(t):t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function it(){return"undefined"!=typeof performance&&performance.memory?{usedHeap:(performance.memory.usedJSHeapSize/1024/1024).toFixed(1),totalHeap:(performance.memory.totalJSHeapSize/1024/1024).toFixed(1),limit:(performance.memory.jsHeapSizeLimit/1024/1024).toFixed(0)}:null}function st(t){if(!t)return null;let e=String(t).trim().toLowerCase();const n={black:"#000000",white:"#FFFFFF",red:"#FF0000",green:"#008000",blue:"#0000FF",yellow:"#FFFF00",cyan:"#00FFFF",magenta:"#FF00FF",gray:"#808080",grey:"#808080",silver:"#C0C0C0",maroon:"#800000",olive:"#808000",lime:"#00FF00",aqua:"#00FFFF",teal:"#008080",navy:"#000080",fuchsia:"#FF00FF",purple:"#800080",orange:"#FFA500"};if(n[e])return n[e];if(e.startsWith("#")&&(e=e.substring(1).toUpperCase(),3===e.length&&(e=e.split("").map(t=>t+t).join("")),6===e.length))return"#"+e;const r=e.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);if(r){const t=t=>parseInt(t,10).toString(16).padStart(2,"0").toUpperCase();return`#${t(r[1])}${t(r[2])}${t(r[3])}`}return null}function ot(t){const e=st(t);return e?`<color rgb="FF${e.replace("#","").toUpperCase()}"/>`:'<color rgb="FF000000"/>'}function lt(t,e=null){return e&&e>0?`<row r="${t}" ht="${e}" customHeight="1">`:`<row r="${t}">`}class ht{constructor(){this.fillMap=new Map,this.fillMap.set("none",0),this.fillMap.set("gray125",1),this.hasBorder=!1,this.hasTextFormat=!1,this.styleMap=new Map,this.styleMap.set("default",0),this.styleMap.set("wrap",1),this.nextFillId=2,this.nextStyleId=2}colorToArgb(t){const e=st(t);return e?"FF"+e.replace("#","").toUpperCase():null}getFillId(t){if(!t)return 0;const e=this.colorToArgb(t);if(!e)return 0;if(this.fillMap.has(e))return this.fillMap.get(e);const n=this.nextFillId++;return this.fillMap.set(e,n),n}getStyleId(t,e=!1){if(!t||"object"!=typeof t)return 1;const n=t.fill||t.bgColor||t.backgroundColor,r=!0===t.border,i=t.align||t.horizontalAlign||null,s=t.valign||t.verticalAlign||null,o=e;if(!(n||r||i||s||o))return 1;r&&(this.hasBorder=!0),o&&(this.hasTextFormat=!0);const l=this.getFillId(n),h=r?1:0,a=o?49:0,u=`fill_${l}_border_${h}_align_${i||"default"}_valign_${s||"default"}_numFmt_${a}`;if(this.styleMap.has(u))return this.styleMap.get(u).id;const c=this.nextStyleId++;return this.styleMap.set(u,{id:c,fillId:l,borderId:h,align:i,valign:s,numFmtId:a}),c}generateStylesXml(){const e=["<fill><patternFill patternType=_xd([52,53,52,63])/></fill>","<fill><patternFill patternType=_xd([61,40,59,35,107,104,111])/></fill>"],n=Array.from(this.fillMap.entries()).filter(([t])=>"none"!==t&&"gray125"!==t).sort((t,e)=>t[1]-e[1]);for(const[t]of n)e.push(`<fill><patternFill patternType=_xd([41,53,54,51,62])><fgColor rgb="${t}"/><bgColor indexed="64"/></patternFill></fill>`);const r=`<fills count="${e.length}">${e.join("")}</fills>`,i=[t([102,56,53,40,62,63,40,100,102,54,63,60,46,117,100,102,40,51,61,50,46,117,100,102,46,53,42,117,100,102,56,53,46,46,53,55,117,100,102,62,51,59,61,53,52,59,54,117,100,102,117,56,53,40,62,63,40,100])];this.hasBorder&&i.push('<border><left style="thin"><color auto="1"/></left><right style="thin"><color auto="1"/></right><top style="thin"><color auto="1"/></top><bottom style="thin"><color auto="1"/></bottom><diagonal/></border>');const s=`<borders count="${i.length}">${i.join("")}</borders>`,o=this.hasTextFormat?'<numFmts count="1"><numFmt numFmtId="49" formatCode="@"/></numFmts>':"",l=['<xf numFmtId="0" fontId="0" fillId="0" borderId="0" xfId="0"/>','<xf numFmtId="0" fontId="0" fillId="0" borderId="0" xfId="0" applyAlignment="1"><alignment wrapText="1" vertical="center"/></xf>'],h=Array.from(this.styleMap.entries()).filter(([t])=>"default"!==t&&"wrap"!==t).sort((t,e)=>t[1].id-e[1].id);for(const[,t]of h){const e=t.numFmtId||0,n=e>0?' applyNumberFormat="1"':"",r=t.fillId>0?' applyFill="1"':"",i=t.borderId>0?' applyBorder="1"':"";let s='wrapText="1"';t.align&&(s+=` horizontal="${t.align}"`),s+=` vertical="${t.valign&&"default"!==t.valign?t.valign:"center"}"`,l.push(`<xf numFmtId="${e}" fontId="0" fillId="${t.fillId||0}" borderId="${t.borderId||0}" xfId="0"${n}${r}${i} applyAlignment="1"><alignment ${s}/></xf>`)}return`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<styleSheet xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52])>\n${o}\n<fonts count="1"><font><sz val="11"/><name val="Calibri"/></font></fonts>\n${r}\n${s}\n<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>\n<cellXfs count="${l.length}">${l.join("")}</cellXfs>\n</styleSheet>`}}const at={name:"style"};function ut(e){let n=e.replace(/<(td|th|tr|table|tbody|thead|tfoot)(\s|>)/gi,t([102,41,42,59,52,126,104])).replace(/<\/(td|th|tr|table|tbody|thead|tfoot)>/gi,t([102,117,41,42,59,52,100]));return(new DOMParser).parseFromString(n,"text/html").body.childNodes}function ct(e,n={}){let r="";return e.forEach(e=>{if(e.nodeType===Node.TEXT_NODE){const i=e.textContent;if(i){const e=function(e){const n={"font-weight":e=>"bold"===e?t([102,56,117,100]):"","font-style":e=>"italic"===e?t([102,51,117,100]):"",color:t=>ot(t),"text-decoration":e=>{let n="";return e.includes("underline")&&(n+='<u val="single"/>'),e.includes("line-through")&&(n+=t([102,41,46,40,51,49,63,117,100])),n},"font-size":t=>{let e=parseFloat(t);return t.includes("pt")?e=parseFloat(t):t.includes("px")&&(e=.75*parseFloat(t)),`<sz val="${e}"/>`},"font-family":t=>`<rFont val="${t}"/>`};let r=t([102,40,10,40,100]);for(let t in e)n[t]&&(r+=n[t](e[t]));const i=e["font-size"],s=e["font-family"];return i&&!s&&(r+='<rFont val="宋体"/>'),r+=t([102,117,40,10,40,100]),r}(n);r+=`<r>${e}<t xml:space="preserve">${rt(i)}</t></r>`}}else if(e.nodeType===Node.ELEMENT_NODE){const t=e.tagName.toLowerCase(),i=e.getAttribute("style")||"";let s={...n};if(s=function(t,e){return e?(e.split(";").filter(t=>""!==t.trim()).forEach(e=>{const[n,r]=e.split(":").map(t=>t.trim());n&&r&&(t[n]=r)}),t):t}(s,i),"b"===t||"strong"===t)s["font-weight"]="bold";else if("i"===t||"em"===t)s["font-style"]="italic";else if("u"===t)s["text-decoration"]=(s["text-decoration"]||"")+" underline";else if("s"===t||"del"===t||"strike"===t)s["text-decoration"]=(s["text-decoration"]||"")+" line-through";else if("br"===t)return void(r+='<r><rPr/><t xml:space="preserve">\n</t></r>');r+=ct(e.childNodes,s)}}),r}function ft(t){return"string"==typeof t&&/<[^>]+>/.test(t)}function dt(t){return t&&(t.color||t.bold||t.italic||t.underline||t.strikethrough||t.strike||t.fontSize||t.fontFamily)}function mt(e){let n=t([102,40,10,40,100]);return e.bold&&(n+=t([102,56,117,100])),e.italic&&(n+=t([102,51,117,100])),e.underline&&(n+='<u val="single"/>'),(e.strikethrough||e.strike)&&(n+=t([102,41,46,40,51,49,63,117,100])),e.color&&(n+=ot(e.color)),e.fontSize&&(n+=`<sz val="${e.fontSize}"/>`),e.fontFamily?n+=`<rFont val="${e.fontFamily}"/>`:e.fontSize&&(n+='<rFont val="宋体"/>'),n+=t([102,117,40,10,40,100]),n}const gt={name:"richtext",processValue(t,e){if(ft(t)){const n=ut(t),r=function(t){if(!t)return{};const e={};return t.fontSize&&(e["font-size"]=`${t.fontSize}pt`),t.fontFamily&&(e["font-family"]=t.fontFamily),t.bold&&(e["font-weight"]="bold"),t.italic&&(e["font-style"]="italic"),t.underline&&(e["text-decoration"]="underline"),(t.strikethrough||t.strike)&&(e["text-decoration"]=(e["text-decoration"]||"")+" line-through"),t.color&&(e.color=t.color),e}(e);return{isRichText:!0,content:ct(n,r)}}return dt(e)?{isRichText:!0,content:`<r>${mt(e)}<t xml:space="preserve">${rt(String(t))}</t></r>`}:{isRichText:!1,content:rt(String(t))}}};function wt(){return""}function xt(){return""}function vt(t){return t?t.replace(/\.(xlsx?|xls|xlsm|csv)$/i,"")+".xlsx":"export.xlsx"}class pt{constructor(){this.m=null,this.v={get height(){return null},set height(t){}}}setRow(){return{height:null}}getRow(){return null}getHeight(){return this.m}getHeaderHeight(){return null}getDefaultConfig(){return this.v}clear(){return this}}class yt{constructor(){this.$=10;const t=this;this.v={get width(){return t.$},set width(t){}}}setCol(){return{width:null}}getCol(){return null}getWidth(){return this.$}fromArray(){return this}getMaxCol(){return 0}getDefaultConfig(){return this.v}generateColsXml(e){if(0===e)return"";let n=t([102,57,53,54,41,100]);for(let t=1;t<=e;t++)n+=`<col min="${t}" max="${t}" width="${this.$}" customWidth="1"/>`;return n+=t([102,117,57,53,54,41,100]),n}clear(){return this}}class $t{constructor(){this.images=[]}hasImages(){return!1}hasImagesForSheet(){return!1}getContentTypesAdditions(){return{extensions:[],overrides:[]}}generateDrawingXml(){return""}generateDrawingRelsXml(){return""}generateSheetDrawingRel(){return""}getImageBinary(){return null}getExtension(){return"png"}clear(){this.images=[]}addImage(){return-1}}function _t(e){if(!e||0===e.length)return"";let n=`<mergeCells count="${e.length}">`;for(const t of e){let e,r,i,s;Array.isArray(t)?[e,r,i,s]=t:void 0!==t.y?(e=t.y,r=t.x,i=e+(t.h||1)-1,s=r+(t.w||1)-1):(e=t.startRow,r=t.startCol,i=t.endRow,s=t.endCol),n+=`<mergeCell ref="${nt.encodeAddress(e,r)}:${nt.encodeAddress(i,s)}"/>`}return n+=t([102,117,55,63,40,61,63,25,63,54,54,41,100]),n}function Ct(e,n,r,i,s,o,l){const h=nt.encodeAddress(e,n);if("object"!=typeof r||null===r)return`<c r="${h}" t=_xd([51,52,54,51,52,63,9,46,40]) s="${i.getStyleId(r)}"><is><t>${rt(String(r||""))}</t></is></c>`;if("img"===r.type&&r.imageUrl&&l){const s=i.getStyleId(r),o=r.merge||{},a=o.rowSpan||r.rowSpan||1,u=o.colSpan||r.colSpan||1;return l.addImage({data:r.imageUrl,row:e,col:n,width:r.width||80,height:r.height||80,rowSpan:a,colSpan:u,editAs:r.editAs||t([53,52,63,25,63,54,54]),sheetIndex:1}),`<c r="${h}" s="${s}"/>`}r.link&&s&&s.push({row:e,col:n,url:r.link,tooltip:r.linkTooltip||""});const a=r.value??"";if("number"==typeof a&&!isNaN(a))return`<c r="${h}" s="${i.getStyleId(r)}"><v>${a}</v></c>`;const u=(o||gt).processValue(a,r),c=i.getStyleId(r,u.isRichText);return u.isRichText?`<c r="${h}" t=_xd([51,52,54,51,52,63,9,46,40]) s="${c}"><is>${u.content}</is></c>`:`<c r="${h}" t=_xd([51,52,54,51,52,63,9,46,40]) s="${c}"><is><t>${u.content}</t></is></c>`}class bt{constructor(){this.plugins=[]}use(t){return t&&t.name&&!this.plugins.find(e=>e.name===t.name)&&this.plugins.push(t),this}async export(e){const{worksheets:n,dataSource:r,mergeArr:i,onProgress:s,fileName:o="export.xlsx",rowConfig:l,colConfig:h,imageManager:a,richtextProcessor:u,hyperlinkXmlGenerator:c,hyperlinkRelsGenerator:f,workSheetMaxRowsNum:d=1e6}=e,m=vt(o),g=c||wt,w=f||xt,x=s||(()=>{});x(0,"init","开始导出...",it());const v=new ht,p=Math.min(d,et);let y;if(n&&n.length>0)y=n;else{if(!r||!r.getPageData)throw new Error("必须提供工作表配置");y=[{name:"Sheet1",dataSource:r,mergeArr:i,rowConfig:l||new pt,colConfig:h||new yt,imageManager:a||new $t}]}let $=0;const _=[];let C=!1;for(const t of y){const e=t.dataSource,n=e.totalRows;if(-1===n)C=!0,_.push({name:t.name,dataSource:e,columnCount:t.columnCount||e.headerRow?.length||0,mergeArr:t.mergeArr,rowConfig:t.rowConfig||new pt,colConfig:t.colConfig||new yt,imageManager:t.imageManager||new $t,startRow:0,endRow:1/0,isStreamMode:!0});else{$+=n;const r=Math.ceil(n/p);for(let i=0;i<r;i++){const s=r>1?`${t.name}_${i+1}`:t.name;_.push({name:s,dataSource:e,columnCount:t.columnCount||e.headerRow?.length||0,mergeArr:0===i?t.mergeArr:null,rowConfig:t.rowConfig||new pt,colConfig:t.colConfig||new yt,imageManager:t.imageManager||new $t,startRow:i*p,endRow:Math.min((i+1)*p,n),isStreamMode:!1})}}}const b=_.length;x(2,"init",C?`导出模式，${b} 个工作表`:`共 ${$.toLocaleString()} 行，${b} 个工作表`,it());const T=tt.createWriteStream(m).getWriter(),F=new TextEncoder;let M=0,S=0;return new Promise((e,n)=>{const r=new H((t,r,i)=>{if(t)return T.abort(),void n(t);T.write(r).then(()=>{M+=r.length,i&&T.close().then(()=>{const t=(M/1024/1024).toFixed(2);x(100,"done",`导出完成！共 ${S} 行，文件大小: ${t}MB`,it()),e({success:!0,rows:S,sheets:b,sizeMB:t})})})});(async()=>{try{let e="";for(let t=1;t<=b;t++)e+=`  <Override PartName="/xl/worksheets/sheet${t}.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,45,53,40,49,41,50,63,63,46,113,34,55,54])/>\n`;let n="",i="";const s=new Set,o=[];for(const t of _)if(t.imageManager&&t.imageManager.hasImages()){const e=t.imageManager.getContentTypesAdditions();e.extensions.forEach(t=>s.add(t)),o.push(...e.overrides)}s.size>0&&(n=[...s].map(t=>"  "+t).join("\n")+"\n"),o.length>0&&(i=o.map(t=>"  "+t).join("\n")+"\n");const l=new B("[Content_Types].xml",{level:6});r.add(l),l.push(F.encode(`<?xml version="1.0"?>\n<Types xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,57,53,52,46,63,52,46,119,46,35,42,63,41])>\n  <Default Extension="xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,34,55,54])/>\n  <Default Extension="rels" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,42,59,57,49,59,61,63,116,40,63,54,59,46,51,53,52,41,50,51,42,41,113,34,55,54])/>\n${n}  <Override PartName="/xl/workbook.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,50,63,63,46,116,55,59,51,52,113,34,55,54])/>\n${e}${i}  <Override PartName="/xl/styles.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,46,35,54,63,41,113,34,55,54])/>\n</Types>`),!0),x(3,"building","写入元数据...",it());const h=new B("_rels/.rels",{level:6});r.add(h),h.push(F.encode('<?xml version="1.0"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <Relationship Id="rId1" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46]) Target=_xd([34,54,117,45,53,40,49,56,53,53,49,116,34,55,54])/>\n</Relationships>'),!0);let a="";for(let t=0;t<b;t++)a+=`    <sheet name="${rt(_[t].name)}" sheetId="${t+1}" r:id="rId${t+1}"/>\n`;const c=new B("xl/workbook.xml",{level:6});r.add(c),c.push(F.encode(`<?xml version="1.0"?>\n<workbook xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) xmlns:r=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <sheets>\n${a}  </sheets>\n</workbook>`),!0);let f="";for(let t=1;t<=b;t++)f+=`  <Relationship Id="rId${t}" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,45,53,40,49,41,50,63,63,46]) Target=_xd([45,53,40,49,41,50,63,63,46,41,117,41,50,63,63,46,126,33,51,39,116,34,55,54])/>\n`;const d=b+1,m=new B("xl/_rels/workbook.xml.rels",{level:6});r.add(m),m.push(F.encode(`<?xml version="1.0"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n${f}  <Relationship Id="rId${d}" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,41,46,35,54,63,41]) Target=_xd([41,46,35,54,63,41,116,34,55,54])/>\n</Relationships>`),!0),x(5,"building","开始写入数据...",it());for(let e=0;e<b;e++){const n=_[e],i=e+1,{dataSource:s,columnCount:o,mergeArr:l,rowConfig:h,colConfig:a,imageManager:c,startRow:f,endRow:d}=n,{headerRow:m,getPageData:p,pageSize:y}=s,C=o||m?.length||0,T=Math.min(y||1e3,1e3),M=d-f;x(5+e/b*85,"building",`正在写入工作表 ${n.name} (${i}/${b})...`,it());const I=new B(`xl/worksheets/sheet${i}.xml`,{level:6});r.add(I);let k=`<?xml version="1.0" encoding="UTF-8"?>\n<worksheet xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) xmlns:r=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n${a.generateColsXml(C)}\n<sheetData>`;I.push(F.encode(k),!1);let R=1,A=0;const N=[];let P=f;if(m){let e=lt(R,h.getHeaderHeight());for(let t=1;t<=C;t++)e+=Ct(R,t,m[t-1],v,N,u,c);e+=t([102,117,40,53,45,100,6,52]),I.push(F.encode(e),!1),R++}const E=100,U=n.isStreamMode;for(;U||!(A>=M||P>=d);){let e;if(U)e=await p();else{const t=Math.floor(P/T),n=P%T;e=await p(t,T),e&&n>0&&(e=e.slice(n))}if(!e||0===e.length)break;let r="",i=0;for(let n=0;n<e.length&&(U||!(A>=M));n++){const s=e[n];let o=lt(R,h.getHeight(R));for(let t=1;t<=C;t++)o+=Ct(R,t,s[t-1],v,N,u,c);o+=t([102,117,40,53,45,100,6,52]),r+=o,R++,A++,P++,S++,i++,i>=E&&(I.push(F.encode(r),!1),r="",i=0)}r&&I.push(F.encode(r),!1),x(U?Math.min(90,5+Math.floor(S/1e3)):Math.round(5+S/$*85),"building",`工作表 ${n.name}，已写入 ${S.toLocaleString()} 行`,it()),await new Promise(t=>setTimeout(t,0))}let D=t([102,117,41,50,63,63,46,30,59,46,59,100,6,52]);l&&l.length>0&&(D+=_t(l)),N.length>0&&(D+="\n"+g(N)),c.hasImagesForSheet(i)&&(D+='\n<drawing r:id="rId1"/>'),D+="\n</worksheet>",I.push(F.encode(D),!0);const O=c.hasImagesForSheet(i),z=N.filter(t=>!t.url.startsWith("#"));if(O||z.length>0){const t=new B(`xl/worksheets/_rels/sheet${i}.xml.rels`,{level:6});r.add(t);let e=O?c.generateSheetDrawingRel(i):"";if(z.length>0&&(e+=w(z)),t.push(F.encode(`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  ${e}\n</Relationships>`),!0),O){const t=new B(`xl/drawings/drawing${i}.xml`,{level:6});r.add(t),t.push(F.encode(c.generateDrawingXml(i)),!0);const e=new B(`xl/drawings/_rels/drawing${i}.xml.rels`,{level:6});r.add(e),e.push(F.encode(c.generateDrawingRelsXml(i)),!0)}}}x(92,"building","写入样式...",it());const p=new B("xl/styles.xml",{level:6});if(r.add(p),p.push(F.encode(v.generateStylesXml()),!0),_.some(t=>t.imageManager&&t.imageManager.hasImages())){x(93,"building","写入图片...",it());for(const t of _)if(t.imageManager&&t.imageManager.hasImages())for(const e of t.imageManager.images){const n=t.imageManager.getImageBinary(e.id);if(n){const i=new B(`xl/media/image${e.id}.${t.imageManager.getExtension(e.type)}`,{level:6});r.add(i),i.push(n,!0)}}}x(95,"compressing","完成压缩...",it()),r.end()}catch(t){T.abort(),x(0,"error",`导出失败: ${t.message}`,it()),n(t)}})()})}}function Tt(){return new bt}class Ft{constructor(){this._=null,this.C=null,this.T=new TextEncoder,this.F=null,this.M=0,this.S=0,this.I=0,this.k=!1,this.R=new ht,this.A=0,this.N=null,this.P=[],this.U=null,this.D=null,this.O=null,this.W="export.xlsx",this.X=[],this.j=0,this.B=[],this.H=null,this.q=new Map}async init(t){if(this.k)return;const{fileName:e="export.xlsx",onProgress:n}=t;this.W=vt(e),this.U=n||(()=>{}),this.U(0,"init","初始化导出...",it());const r=tt.createWriteStream(this.W);return this.C=r.getWriter(),new Promise((t,e)=>{this.D=t,this.O=e,this._=new H((t,n,r)=>{if(t)return this.C.abort(),void e(t);this.C.write(n).then(()=>{this.I+=n.length,r&&this.C.close().then(()=>{const t=(this.I/1024/1024).toFixed(2),e=this.X?.length||1;this.U(100,"done",`导出完成！共 ${this.S} 行，${e} 个工作表，文件大小: ${t}MB`,it()),this.G&&this.G({success:!0,rows:this.S,sheets:e,sizeMB:t})})})}),this.k=!0,t()})}async beginSheet(e){if(!this.k)throw new Error("请先调用 init() 初始化流");const{sheetName:n=`Sheet${this.X.length+1}`,headerRow:r,columns:i,rowConfig:s,colConfig:o,mergeArr:l,imageManager:h}=e,a={name:n,mergeArr:l||[],imageManager:h||new $t,columns:i||r?.length||10,rowConfig:s||new pt,colConfig:o||new yt};this.X.push(a),this.j=this.X.length,this.B=a.mergeArr,this.H=a.imageManager,this.M=0,this.A=a.columns,this.N=a.rowConfig,this.L=a.colConfig,this.q.clear();const u=this.T;this.F=new B(`xl/worksheets/sheet${this.j}.xml`,{level:6}),this._.add(this.F);let c="";if(this.L&&this.L.generateColsXml&&(c=this.L.generateColsXml(this.A)),this.F.push(u.encode(`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<worksheet xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) xmlns:r=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n${c}<sheetData>\n`),!1),r&&r.length>0){this.M=1;let e=lt(1,this.N.getHeaderHeight?.()||this.N.getHeight?.(1)),n=1,i=0,s=null;for(let t=0;t<r.length;t++){const o=r[t];n<i?(e+=Ct(1,n,{value:"",border:s?.border,fill:s?.fill,bgColor:s?.bgColor,backgroundColor:s?.backgroundColor},this.R,this.P,gt,this.H),n++):(e+=Ct(1,n,o,this.R,this.P,gt,this.H),n++,o&&o.merge&&o.merge.colSpan>1?(i=n+o.merge.colSpan-1,s=o):s=null)}for(;n<=i&&s;)e+=Ct(1,n,{value:"",border:s?.border,fill:s?.fill,bgColor:s?.bgColor,backgroundColor:s?.backgroundColor},this.R,this.P,gt,this.H),n++;e+=t([102,117,40,53,45,100,6,52]),this.F.push(u.encode(e),!1)}this.U(5,"building",`开始写入工作表: ${n}`,it())}async endSheet(){if(!this.F)return;const e=this.T,n=this.X[this.j-1],r=n.imageManager&&n.imageManager.hasImages&&n.imageManager.hasImages();let i=t([102,117,41,50,63,63,46,30,59,46,59,100,6,52]);if(n.mergeArr&&n.mergeArr.length>0&&(i+=_t(n.mergeArr)),r&&(i+='<drawing r:id="rId1"/>\n'),i+=t([102,117,45,53,40,49,41,50,63,63,46,100]),this.F.push(e.encode(i),!0),this.F=null,r){const t=this.j,r=new B(`xl/worksheets/_rels/sheet${t}.xml.rels`,{level:6});this._.add(r),r.push(e.encode('<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <Relationship Id="rId1" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,62,40,59,45,51,52,61]) Target=_xd([116,116,117,62,40,59,45,51,52,61,41,117,62,40,59,45,51,52,61,126,33,41,50,63,63,46,19,62,34,39,116,34,55,54])/>\n</Relationships>'),!0);const i=new B(`xl/drawings/drawing${t}.xml`,{level:6});this._.add(i),i.push(e.encode(n.imageManager.generateDrawingXml(t)),!0);const s=new B(`xl/drawings/_rels/drawing${t}.xml.rels`,{level:6});this._.add(s),s.push(e.encode(n.imageManager.generateDrawingRelsXml(t)),!0);for(const t of n.imageManager.images){const e=n.imageManager.getImageBinary(t.id);if(e){const r=new B(`xl/media/image${t.id}.${n.imageManager.getExtension(t.type)}`,{level:6});this._.add(r),r.push(e,!0)}}}this.S+=this.M,this.U(Math.min(90,5+Math.floor(this.S/1e3)),"building",`工作表 ${n.name} 写入完成，共 ${this.M} 行`,it())}async initLegacy(t){const{fileName:e="export.xlsx",sheetName:n="Sheet1",headerRow:r,columns:i,rowConfig:s,colConfig:o,mergeArr:l,imageManager:h,onProgress:a}=t;await this.init({fileName:e,onProgress:a}),await this.beginSheet({sheetName:n,headerRow:r,columns:i,rowConfig:s,colConfig:o,mergeArr:l,imageManager:h})}V(e){const n=this.T,r=this._;let i="",s="";if(this.J&&this.J.hasImages&&this.J.hasImages()){const t=this.J.getContentTypesAdditions();t.extensions.length>0&&(i=t.extensions.map(t=>"  "+t).join("\n")+"\n"),s='  <Override PartName="/xl/drawings/drawing1.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,62,40,59,45,51,52,61,113,34,55,54])/>\n'}const o=new B("[Content_Types].xml",{level:6});r.add(o),o.push(n.encode(`<?xml version="1.0" encoding="UTF-8"?>\n<Types xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,57,53,52,46,63,52,46,119,46,35,42,63,41])>\n  <Default Extension="rels" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,42,59,57,49,59,61,63,116,40,63,54,59,46,51,53,52,41,50,51,42,41,113,34,55,54])/>\n  <Default Extension="xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,34,55,54])/>\n${i}  <Override PartName="/xl/workbook.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,50,63,63,46,116,55,59,51,52,113,34,55,54])/>\n  <Override PartName="/xl/worksheets/sheet1.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,45,53,40,49,41,50,63,63,46,113,34,55,54])/>\n${s}  <Override PartName="/xl/styles.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,46,35,54,63,41,113,34,55,54])/>\n  <Override PartName="/xl/sharedStrings.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,50,59,40,63,62,9,46,40,51,52,61,41,113,34,55,54])/>\n</Types>`),!0);const l=new B("_rels/.rels",{level:6});r.add(l),l.push(n.encode('<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <Relationship Id="rId1" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46]) Target=_xd([34,54,117,45,53,40,49,56,53,53,49,116,34,55,54])/>\n</Relationships>'),!0);const h=new B("xl/_rels/workbook.xml.rels",{level:6});r.add(h),h.push(n.encode('<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <Relationship Id="rId1" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,45,53,40,49,41,50,63,63,46]) Target=_xd([45,53,40,49,41,50,63,63,46,41,117,41,50,63,63,46,107,116,34,55,54])/>\n  <Relationship Id="rId2" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,41,46,35,54,63,41]) Target=_xd([41,46,35,54,63,41,116,34,55,54])/>\n  <Relationship Id="rId3" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,41,50,59,40,63,62,9,46,40,51,52,61,41]) Target=_xd([41,50,59,40,63,62,9,46,40,51,52,61,41,116,34,55,54])/>\n</Relationships>'),!0);const a=new B("xl/workbook.xml",{level:6});r.add(a),a.push(n.encode(`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<workbook xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) xmlns:r=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <sheets><sheet name="${rt(this.K)}" sheetId="1" r:id="rId1"/></sheets>\n</workbook>`),!0);const u=new B("xl/sharedStrings.xml",{level:6});r.add(u),u.push(n.encode('<?xml version="1.0" encoding="UTF-8"?>\n<sst xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) count="0" uniqueCount="0"/>'),!0),this.F=new B("xl/worksheets/sheet1.xml",{level:6}),r.add(this.F);let c="";if(this.L&&this.L.generateColsXml&&(c=this.L.generateColsXml(this.A)),this.F.push(n.encode(`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<worksheet xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) xmlns:r=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n${c}<sheetData>\n`),!1),e&&e.length>0){this.M=1;let r=lt(1,this.N.getHeaderHeight?.()||this.N.getHeight?.(1)),i=1,s=0,o=null;for(let t=0;t<e.length;t++){const n=e[t];i<s?(r+=Ct(1,i,{value:"",border:o?.border,fill:o?.fill,bgColor:o?.bgColor,backgroundColor:o?.backgroundColor},this.R,this.P,gt,this.J),i++):(r+=Ct(1,i,n,this.R,this.P,gt,this.J),i++,n&&n.merge&&n.merge.colSpan>1?(s=i+n.merge.colSpan-1,o=n):o=null)}for(;i<=s&&o;)r+=Ct(1,i,{value:"",border:o?.border,fill:o?.fill,bgColor:o?.bgColor,backgroundColor:o?.backgroundColor},this.R,this.P,gt,this.H),i++;r+=t([102,117,40,53,45,100,6,52]),this.F.push(n.encode(r),!1)}this.U(5,"building","写入就绪...",it())}async writeRows(e){if(!this.k)throw new Error("请先调用 init() 初始化流");if(!e||0===e.length)return;const n=this.T;let r="";for(let i=0;i<e.length;i++){this.M++;const s=e[i],o=this.N.getHeight?.(this.M);let l=lt(this.M,o);const h=this.H||this.J;let a=1,u=0,c=null;for(let t=0;t<s.length;t++){const e=s[t],n=this.q.get(a);if(n){if(this.M<=n.endRow){const e={value:"",border:n.style?.border,fill:n.style?.fill,bgColor:n.style?.bgColor,backgroundColor:n.style?.backgroundColor};if(l+=Ct(this.M,a,e,this.R,this.P,gt,h),a++,n.colSpan>1)for(let r=1;r<n.colSpan&&t+1<s.length;r++)t++,a++,l+=Ct(this.M,a-1,e,this.R,this.P,gt,h);continue}this.q.delete(a)}if(a<u){const t={value:"",border:c?.border,fill:c?.fill,bgColor:c?.bgColor,backgroundColor:c?.backgroundColor};l+=Ct(this.M,a,t,this.R,this.P,gt,h),a++;continue}if(l+=Ct(this.M,a,e,this.R,this.P,gt,h),e&&e.merge){const{rowSpan:t=1,colSpan:n=1}=e.merge;n>1?(u=a+n,c=e):c=null,t>1&&this.q.set(a,{endRow:this.M+t-1,colSpan:n,style:e})}else c=null;a++}for(;a<u&&c;){const t={value:"",border:c?.border,fill:c?.fill,bgColor:c?.bgColor,backgroundColor:c?.backgroundColor};l+=Ct(this.M,a,t,this.R,this.P,gt,h),a++}l+=t([102,117,40,53,45,100,6,52]),r+=l,(i+1)%100==0&&(this.F.push(n.encode(r),!1),r="",await new Promise(t=>setTimeout(t,0)))}r&&this.F.push(n.encode(r),!1);const i=this.X[this.j-1],s=i?i.name:`Sheet${this.j}`;this.U(Math.min(90,5+Math.floor(this.M/1e3)),"building",`[${s}] 已写入 ${this.M.toLocaleString()} 行`,it())}setMergeArr(t){Array.isArray(t)&&(this.Y=t)}setImageManager(t){t&&(this.J=t)}async finish(){if(!this.k)throw new Error("请先调用 init() 初始化流");const e=this.T;if(this.X&&this.X.length>0)return this.Z();const n=this.J&&this.J.hasImages&&this.J.hasImages();let r=t([102,117,41,50,63,63,46,30,59,46,59,100,6,52]);if(this.Y&&this.Y.length>0&&(r+=_t(this.Y)),n&&(r+='<drawing r:id="rId1"/>\n'),r+=t([102,117,45,53,40,49,41,50,63,63,46,100]),this.F.push(e.encode(r),!0),n){const t=new B("xl/worksheets/_rels/sheet1.xml.rels",{level:6});this._.add(t),t.push(e.encode('<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <Relationship Id="rId1" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,62,40,59,45,51,52,61]) Target=_xd([116,116,117,62,40,59,45,51,52,61,41,117,62,40,59,45,51,52,61,107,116,34,55,54])/>\n</Relationships>'),!0);const n=new B("xl/drawings/drawing1.xml",{level:6});this._.add(n),n.push(e.encode(this.J.generateDrawingXml(1)),!0);const r=new B("xl/drawings/_rels/drawing1.xml.rels",{level:6});this._.add(r),r.push(e.encode(this.J.generateDrawingRelsXml(1)),!0),this.U(92,"building","写入图片...",it());for(const t of this.J.images){const e=this.J.getImageBinary(t.id);if(e){const n=new B(`xl/media/image${t.id}.${this.J.getExtension(t.type)}`,{level:6});this._.add(n),n.push(e,!0)}}}const i=new B("xl/styles.xml",{level:6});return this._.add(i),i.push(e.encode(this.R.generateStylesXml()),!0),this.U(95,"compressing","完成压缩...",it()),new Promise(t=>{this.G=t,this._.end()})}async Z(){const t=this.T,e=this._,n=this.X,r=n.length;this.U(90,"building",`写入 ${r} 个工作表的元数据...`,it());let i=!1;const s=[];for(let t=0;t<r;t++){const e=n[t];e.imageManager&&e.imageManager.hasImages&&e.imageManager.hasImages()&&(i=!0,s.push(t+1))}let o="";if(i){const t=new Set;for(const e of n)if(e.imageManager&&e.imageManager.getContentTypesAdditions){const n=e.imageManager.getContentTypesAdditions();if(n.extensions)for(const e of n.extensions)t.add(e)}o=Array.from(t).map(t=>"  "+t).join("\n"),o&&(o+="\n")}let l="";for(const t of s)l+=`  <Override PartName="/xl/drawings/drawing${t}.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,62,40,59,45,51,52,61,113,34,55,54])/>\n`;let h="";for(let t=1;t<=r;t++)h+=`  <Override PartName="/xl/worksheets/sheet${t}.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,45,53,40,49,41,50,63,63,46,113,34,55,54])/>\n`;const a=new B("[Content_Types].xml",{level:6});e.add(a),a.push(t.encode(`<?xml version="1.0" encoding="UTF-8"?>\n<Types xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,57,53,52,46,63,52,46,119,46,35,42,63,41])>\n  <Default Extension="rels" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,42,59,57,49,59,61,63,116,40,63,54,59,46,51,53,52,41,50,51,42,41,113,34,55,54])/>\n  <Default Extension="xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,34,55,54])/>\n${o}  <Override PartName="/xl/workbook.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,50,63,63,46,116,55,59,51,52,113,34,55,54])/>\n${h}${l}  <Override PartName="/xl/styles.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,46,35,54,63,41,113,34,55,54])/>\n  <Override PartName="/xl/sharedStrings.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,50,59,40,63,62,9,46,40,51,52,61,41,113,34,55,54])/>\n</Types>`),!0);const u=new B("_rels/.rels",{level:6});e.add(u),u.push(t.encode('<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <Relationship Id="rId1" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46]) Target=_xd([34,54,117,45,53,40,49,56,53,53,49,116,34,55,54])/>\n</Relationships>'),!0);let c='<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>';for(let t=1;t<=r;t++)c+=`\n  <Relationship Id="rId${t}" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,45,53,40,49,41,50,63,63,46]) Target=_xd([45,53,40,49,41,50,63,63,46,41,117,41,50,63,63,46,126,33,51,39,116,34,55,54])/>`;c+=`\n  <Relationship Id="rId${r+1}" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,41,46,35,54,63,41]) Target=_xd([41,46,35,54,63,41,116,34,55,54])/>`,c+=`\n  <Relationship Id="rId${r+2}" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,41,50,59,40,63,62,9,46,40,51,52,61,41]) Target=_xd([41,50,59,40,63,62,9,46,40,51,52,61,41,116,34,55,54])/>`,c+="\n</Relationships>";const f=new B("xl/_rels/workbook.xml.rels",{level:6});e.add(f),f.push(t.encode(c),!0);let d="";for(let t=0;t<r;t++)d+=`<sheet name="${rt(n[t].name)}" sheetId="${t+1}" r:id="rId${t+1}"/>`;const m=new B("xl/workbook.xml",{level:6});e.add(m),m.push(t.encode(`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<workbook xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) xmlns:r=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <sheets>${d}</sheets>\n</workbook>`),!0);const g=new B("xl/sharedStrings.xml",{level:6});e.add(g),g.push(t.encode('<?xml version="1.0" encoding="UTF-8"?>\n<sst xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) count="0" uniqueCount="0"/>'),!0);const w=new B("xl/styles.xml",{level:6});return e.add(w),w.push(t.encode(this.R.generateStylesXml()),!0),this.U(95,"compressing","完成压缩...",it()),new Promise(t=>{this.G=t,this._.end()})}}function Mt(){return new Ft}const St={name:"hyperlink"};function It(){return""}function kt(){return""}function Rt(){return null}function At(){return new $t}const Nt={name:"merge"},Pt={name:"image"},Et={name:"rowcol"};function Ut(){return new pt}function Dt(){return new yt}class Ot{constructor(t,e,n,r={}){this.tt=t,this.et=e,this.nt=n,this.rt=null,this.Y=null,this.it=[],this.st=null,this.ot=r.columnCount||null,this.lt=null,this.ht=!1,this.ut=0,this.N=t.ct(),this.L=t.ft(),this.J=t.dt()}get name(){return this.et}get index(){return this.nt}get rowCount(){return this.it.length}get columnCount(){return this.gt()}setRow(t){return"default"===t?this.N.getDefaultConfig():this.N.setRow(t)}setCol(t){return"default"===t?this.L.getDefaultConfig():this.L.setCol(t)}setColumns(t){return this.L.fromArray(t),this}setColumnCount(t){return this.ot=t,this}gt(){if(this.ot)return this.ot;const t=this.L.getMaxCol?this.L.getMaxCol():0;let e=0;this.st&&(e=Math.max(e,this.st.length));for(const t of this.it)Array.isArray(t)&&(e=Math.max(e,t.length));const n=this.wt();return Math.max(t,e,n)}wt(){if(!this.Y||0===this.Y.length)return 0;let t=0;for(const e of this.Y){let n=0;Array.isArray(e)?n=e[3]||0:void 0!==e.endCol?n=e.endCol:void 0!==e.x&&void 0!==e.w&&(n=e.x+(e.w||1)-1),t=Math.max(t,n)}return t}setMergeCells(t){return this.Y=t,this}merge(t,e,n,r){this.Y||(this.Y=[]),t=Math.max(1,Math.floor(t)||1),e=Math.max(1,Math.floor(e)||1);const i=t+(n=Math.max(1,Math.floor(n)||1))-1,s=e+(r=Math.max(1,Math.floor(r)||1))-1;return this.Y.push([t,e,i,s]),this}xt(t){let e=0;for(let n=0;n<t.length;n++)e=26*e+(t.charCodeAt(n)-64);return e}setHeaderRow(t){return this.st=t,this}async addRow(t){return t&&"object"==typeof t&&!Array.isArray(t)||Array.isArray(t)&&await this.addRows([t]),this}async addRows(t){if(!Array.isArray(t))return this;let e=t;if(!this.ht){const n=t[0];e=t.slice(1),this.ut=1,this.vt(n,1);let r=this.ot;r||(r=this.yt(t)),(!r||r<1)&&(r=10),this.ot=r,await this.tt.$t(this,n,r),this.lt=this.tt._t,this.ht=!0}return await this.Ct(e),this}async Ct(t){if(!t||0===t.length)return;const e=this.tt.bt;let n=t;for(;n.length>0;){const t=e-(this.lt.M||0);t<=0&&await this.Tt();const r=Math.min(n.length,t>0?t:e),i=n.slice(0,r);n=n.slice(r);for(const t of i)Array.isArray(t)&&(this.ut++,this.vt(t,this.ut));await this.lt.writeRows(i),n.length>0&&this.lt.M>=e&&await this.Tt()}}async Tt(){const t=this.tt,e=t._t,n=e.X[e.j-1];n&&this.Y&&(n.mergeArr=this.Y),await e.endSheet();const r=this.et;let i=2,s=`${r}_${i}`;for(;t.Ft.has(s);)i++,s=`${r}_${i}`;t.Ft.add(s),this.Y=[],this.ut=0,await e.beginSheet({sheetName:s,headerRow:null,columns:this.ot,rowConfig:this.N,colConfig:this.L,mergeArr:this.Y,imageManager:t.dt()})}Mt(t){if(!Array.isArray(t))return 0;let e=t.length;for(let n=0;n<t.length;n++){const r=t[n];if(r&&r.merge&&r.merge.colSpan>1){const t=n+r.merge.colSpan;t>e&&(e=t)}}return e}yt(t){let e=0;for(const n of t){const t=this.Mt(n);t>e&&(e=t)}return e}vt(t,e){let n=1,r=0;for(let i=0;i<t.length;i++){const s=t[i];if(n<r)n++;else{if(s&&s.merge){const{rowSpan:t=1,colSpan:i=1}=s.merge,o=Math.max(1,Math.floor(t)||1),l=Math.max(1,Math.floor(i)||1);if(o>1||l>1){this.Y||(this.Y=[]);const t=e,i=n,s=t+o-1,h=i+l-1;this.Y.push([t,i,s,h]),r=n+l}}n++}}}setDataSource(t){return this.rt=t,this}addImage(t){return this.J.addImage(t),this}reset(){return this.rt=null,this.Y=null,this.it=[],this.st=null,this.N.clear(),this.L.clear(),this.J.clear(),this}St(){return this.rt?(this.st&&!this.rt.headerRow&&(this.rt.headerRow=this.st),this.rt):null}It(){return{name:this.et,dataSource:this.St(),columnCount:this.gt(),mergeArr:this.Y,rowConfig:this.N,colConfig:this.L,imageManager:this.J}}}class zt{constructor(t={}){this.W=t.fileName||"export.xlsx",this.U=t.onProgress||null,this.bt=t.workSheetMaxRowsNum||1e6,tt.configure({useStreamDownload:t.useStreamDownload||!1,streamMitmUrl:t.streamMitmUrl||null}),this.kt=[],this.Ft=new Set,this.Rt=pt,this.At=yt,this.Nt=$t,this.Pt=null,this.Et=null,this.Ut=new bt,this.Dt=!1,this._t=null,this.Ot=null,this.zt=null}Wt(t){return t.RowConfigManager&&(this.Rt=t.RowConfigManager),t.ColConfigManager&&(this.At=t.ColConfigManager),t.ImageManager&&(this.Nt=t.ImageManager),t.generateHyperlinksXml&&(this.Pt=t.generateHyperlinksXml),t.generateHyperlinkRels&&(this.Et=t.generateHyperlinkRels),this.Dt=!0,this}ct(){return new this.Rt}ft(){return new this.At}dt(){return new this.Nt}async Xt(){return this._t||(this._t=Mt(),await this._t.init({fileName:this.W,onProgress:this.U})),this._t}async $t(t,e,n){this.zt&&(await this.zt,this.zt=null);const r=await this.Xt();await r.beginSheet({sheetName:t.et,headerRow:e,columns:n,rowConfig:t.N,colConfig:t.L,mergeArr:t.Y,imageManager:t.J}),this.Ot=t}addWorkSheet(t={}){if(this.Ot&&this._t){const t=this._t.X[this._t.j-1];t&&this.Ot.Y&&(t.mergeArr=this.Ot.Y),this.zt=this._t.endSheet()}let e=t.name;if(e){let t=e,n=1;for(;this.Ft.has(e);)e=`${t}_${n}`,n++}else{let t=1;for(;this.Ft.has(`Sheet${t}`);)t++;e=`Sheet${t}`}this.Ft.add(e);const n=this.kt.length+1,r=new Ot(this,e,n,{columnCount:t.columnCount});return this.kt.push(r),this.Ot=null,r}getWorkSheets(){return[...this.kt]}getWorkSheet(t){return"number"==typeof t?this.kt[t-1]||null:this.kt.find(e=>e.name===t)||null}use(t){return this.Ut.use(t),this}setFileName(t){return this.W=t,this}onProgress(t){return this.U=t,this}get isPro(){return this.Dt}reset(){return this.kt=[],this.Ft.clear(),this}async export(t){if(0===this.kt.length)throw new Error("请先调用 addWorkSheet() 添加工作表");if(this._t){if(this.zt&&(await this.zt,this.zt=null),this.Ot){const t=this._t.X[this._t.j-1];t&&this.Ot.Y&&(t.mergeArr=this.Ot.Y),await this._t.endSheet()}return this._t.finish()}const e=this.kt.find(t=>t.ht&&t.lt);if(e)return e.Y&&e.Y.length>0&&e.lt.setMergeArr(e.Y),e.J&&e.J.hasImages&&e.J.hasImages()&&e.lt.setImageManager(e.J),e.lt.finish();for(const t of this.kt){const e=t.St();if(!e)throw new Error(`工作表 "${t.name}" 未设置数据。请使用 addRow()/addRows() 或 setDataSource() 添加数据`);if(!e.getPageData)throw new Error(`工作表 "${t.name}" 的 dataSource 必须包含 getPageData 函数`)}const n=this.kt.map(t=>t.It());return this.Ut.export({worksheets:n,onProgress:this.U,fileName:t||this.W,hyperlinkXmlGenerator:this.Pt,hyperlinkRelsGenerator:this.Et,workSheetMaxRowsNum:this.bt})}}async function Wt(t,e,n,r,i="export.xlsx",s=null,o=null,l=null){const h=new bt;let a;return o?a=o:n&&"object"==typeof n&&!Array.isArray(n)?a=n:(a=new yt,Array.isArray(n)),h.export({dataSource:t,mergeArr:e,onProgress:r,fileName:i,rowConfig:s||new pt,colConfig:a,imageManager:l||new $t})}export{yt as ColConfigManagerLite,bt as ExcelKernel,zt as FulExcelExport,$t as ImageManager,et as MAX_ROWS_PER_SHEET,pt as RowConfigManagerLite,Ft as StreamExporter,ht as StyleManager,Ot as WorkSheet,_t as buildMergeCellsXml,lt as buildRowStartTag,mt as buildSimpleStyleRpr,nt as colCache,Rt as collectHyperlink,ot as colorToArgbXml,ft as containsHtml,Dt as createColConfig,At as createImageManager,Tt as createKernel,Ut as createRowConfig,Mt as createStreamExporter,zt as default,rt as escapeXml,Wt as exportExcel,kt as generateHyperlinkRels,It as generateHyperlinksXml,it as getMemoryInfo,dt as hasSimpleStyle,St as hyperlinkPlugin,Pt as imagePlugin,Nt as mergePlugin,st as normalizeColor,ut as parseHTML,gt as richtextPlugin,Et as rowcolPlugin,at as stylePlugin};
