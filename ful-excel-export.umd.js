!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).FulExcelExport={})}(this,function(t){"use strict";var e=Uint8Array,n=Uint16Array,r=Int32Array,i=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=function(t,e){for(var i=new n(31),s=0;s<31;++s)i[s]=e+=1<<t[s-1];var o=new r(i[30]);for(s=1;s<30;++s)for(var l=i[s];l<i[s+1];++l)o[l]=l-i[s]<<5|s;return{b:i,r:o}},h=l(i,2),a=h.b,u=h.r;a[28]=258,u[258]=28;for(var c=l(s,0).r,f=new n(32768),d=0;d<32768;++d){var m=(43690&d)>>1|(21845&d)<<1;m=(61680&(m=(52428&m)>>2|(13107&m)<<2))>>4|(3855&m)<<4,f[d]=((65280&m)>>8|(255&m)<<8)>>1}var x=function(t,e,r){for(var i=t.length,s=0,o=new n(e);s<i;++s)t[s]&&++o[t[s]-1];var l,h=new n(e);for(s=1;s<e;++s)h[s]=h[s-1]+o[s-1]<<1;if(r){l=new n(1<<e);var a=15-e;for(s=0;s<i;++s)if(t[s])for(var u=s<<4|t[s],c=e-t[s],d=h[t[s]-1]++<<c,m=d|(1<<c)-1;d<=m;++d)l[f[d]>>a]=u}else for(l=new n(i),s=0;s<i;++s)t[s]&&(l[s]=f[h[t[s]-1]++]>>15-t[s]);return l},g=new e(288);for(d=0;d<144;++d)g[d]=8;for(d=144;d<256;++d)g[d]=9;for(d=256;d<280;++d)g[d]=7;for(d=280;d<288;++d)g[d]=8;var w=new e(32);for(d=0;d<32;++d)w[d]=5;var v=x(g,9,0),p=x(w,5,0),y=function(t){return(t+7)/8|0},_=function(t,n,r){return(null==n||n<0)&&(n=0),(null==r||r>t.length)&&(r=t.length),new e(t.subarray(n,r))},$=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],b=function(t,e,n){var r=new Error(e||$[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,b),!n)throw r;return r},C=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8},T=function(t,e,n){n<<=7&e;var r=e/8|0;t[r]|=n,t[r+1]|=n>>8,t[r+2]|=n>>16},F=function(t,r){for(var i=[],s=0;s<t.length;++s)t[s]&&i.push({s:s,f:t[s]});var o=i.length,l=i.slice();if(!o)return{t:N,l:0};if(1==o){var h=new e(i[0].s+1);return h[i[0].s]=1,{t:h,l:1}}i.sort(function(t,e){return t.f-e.f}),i.push({s:-1,f:25001});var a=i[0],u=i[1],c=0,f=1,d=2;for(i[0]={s:-1,f:a.f+u.f,l:a,r:u};f!=o-1;)a=i[i[c].f<i[d].f?c++:d++],u=i[c!=f&&i[c].f<i[d].f?c++:d++],i[f++]={s:-1,f:a.f+u.f,l:a,r:u};var m=l[0].s;for(s=1;s<o;++s)l[s].s>m&&(m=l[s].s);var x=new n(m+1),g=M(i[f-1],x,0);if(g>r){s=0;var w=0,v=g-r,p=1<<v;for(l.sort(function(t,e){return x[e.s]-x[t.s]||t.f-e.f});s<o;++s){var y=l[s].s;if(!(x[y]>r))break;w+=p-(1<<g-x[y]),x[y]=r}for(w>>=v;w>0;){var _=l[s].s;x[_]<r?w-=1<<r-x[_]++-1:++s}for(;s>=0&&w;--s){var $=l[s].s;x[$]==r&&(--x[$],++w)}g=r}return{t:new e(x),l:g}},M=function(t,e,n){return-1==t.s?Math.max(M(t.l,e,n+1),M(t.r,e,n+1)):e[t.s]=n},S=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new n(++e),i=0,s=t[0],o=1,l=function(t){r[i++]=t},h=1;h<=e;++h)if(t[h]==s&&h!=e)++o;else{if(!s&&o>2){for(;o>138;o-=138)l(32754);o>2&&(l(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(l(s),--o;o>6;o-=6)l(8304);o>2&&(l(o-3<<5|8208),o=0)}for(;o--;)l(s);o=1,s=t[h]}return{c:r.subarray(0,i),n:e}},I=function(t,e){for(var n=0,r=0;r<e.length;++r)n+=t[r]*e[r];return n},k=function(t,e,n){var r=n.length,i=y(e+2);t[i]=255&r,t[i+1]=r>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var s=0;s<r;++s)t[i+s+4]=n[s];return 8*(i+4+r)},R=function(t,e,r,l,h,a,u,c,f,d,m){C(e,m++,r),++h[256];for(var y=F(h,15),_=y.t,$=y.l,b=F(a,15),M=b.t,R=b.l,A=S(_),N=A.c,P=A.n,E=S(M),U=E.c,D=E.n,O=new n(19),z=0;z<N.length;++z)++O[31&N[z]];for(z=0;z<U.length;++z)++O[31&U[z]];for(var j=F(O,7),W=j.t,X=j.l,B=19;B>4&&!W[o[B-1]];--B);var H,q,G,L,V=d+5<<3,J=I(h,g)+I(a,w)+u,K=I(h,_)+I(a,M)+u+14+3*B+I(O,W)+2*O[16]+3*O[17]+7*O[18];if(f>=0&&V<=J&&V<=K)return k(e,m,t.subarray(f,f+d));if(C(e,m,1+(K<J)),m+=2,K<J){H=x(_,$,0),q=_,G=x(M,R,0),L=M;var Q=x(W,X,0);for(C(e,m,P-257),C(e,m+5,D-1),C(e,m+10,B-4),m+=14,z=0;z<B;++z)C(e,m+3*z,W[o[z]]);m+=3*B;for(var Y=[N,U],Z=0;Z<2;++Z){var tt=Y[Z];for(z=0;z<tt.length;++z){var et=31&tt[z];C(e,m,Q[et]),m+=W[et],et>15&&(C(e,m,tt[z]>>5&127),m+=tt[z]>>12)}}}else H=v,q=g,G=p,L=w;for(z=0;z<c;++z){var nt=l[z];if(nt>255){T(e,m,H[257+(et=nt>>18&31)]),m+=q[et+257],et>7&&(C(e,m,nt>>23&31),m+=i[et]);var rt=31&nt;T(e,m,G[rt]),m+=L[rt],rt>3&&(T(e,m,nt>>5&8191),m+=s[rt])}else T(e,m,H[nt]),m+=q[nt]}return T(e,m,H[256]),m+q[256]},A=new r([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),N=new e(0),P=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var n=e,r=9;--r;)n=(1&n&&-306674912)^n>>>1;t[e]=n}return t}(),E=function(t,e,n){for(;n;++e)t[e]=n,n>>>=8},U=function(){function t(t,n){if("function"==typeof t&&(n=t,t={}),this.ondata=n,this.o=t||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new e(98304),this.o.dictionary){var r=this.o.dictionary.subarray(-32768);this.b.set(r,32768-r.length),this.s.i=32768-r.length}}return t.prototype.p=function(t,o){this.ondata(function(t,o,l,h,a){if(!a&&(a={l:1},o.dictionary)){var f=o.dictionary.subarray(-32768),d=new e(f.length+t.length);d.set(f),d.set(t,f.length),t=d,a.w=f.length}return function(t,o,l,h,a,f){var d=f.z||t.length,m=new e(h+d+5*(1+Math.ceil(d/7e3))+a),x=m.subarray(h,m.length-a),g=f.l,w=7&(f.r||0);if(o){w&&(x[0]=f.r>>3);for(var v=A[o-1],p=v>>13,$=8191&v,b=(1<<l)-1,C=f.p||new n(32768),T=f.h||new n(b+1),F=Math.ceil(l/3),M=2*F,S=function(e){return(t[e]^t[e+1]<<F^t[e+2]<<M)&b},I=new r(25e3),N=new n(288),P=new n(32),E=0,U=0,D=f.i||0,O=0,z=f.w||0,j=0;D+2<d;++D){var W=S(D),X=32767&D,B=T[W];if(C[X]=B,T[W]=X,z<=D){var H=d-D;if((E>7e3||O>24576)&&(H>423||!g)){w=R(t,x,0,I,N,P,U,O,j,D-j,w),O=E=U=0,j=D;for(var q=0;q<286;++q)N[q]=0;for(q=0;q<30;++q)P[q]=0}var G=2,L=0,V=$,J=X-B&32767;if(H>2&&W==S(D-J))for(var K=Math.min(p,H)-1,Q=Math.min(32767,D),Y=Math.min(258,H);J<=Q&&--V&&X!=B;){if(t[D+G]==t[D+G-J]){for(var Z=0;Z<Y&&t[D+Z]==t[D+Z-J];++Z);if(Z>G){if(G=Z,L=J,Z>K)break;var tt=Math.min(J,Z-2),et=0;for(q=0;q<tt;++q){var nt=D-J+q&32767,rt=nt-C[nt]&32767;rt>et&&(et=rt,B=nt)}}}J+=(X=B)-(B=C[X])&32767}if(L){I[O++]=268435456|u[G]<<18|c[L];var it=31&u[G],st=31&c[L];U+=i[it]+s[st],++N[257+it],++P[st],z=D+G,++E}else I[O++]=t[D],++N[t[D]]}}for(D=Math.max(D,z);D<d;++D)I[O++]=t[D],++N[t[D]];w=R(t,x,g,I,N,P,U,O,j,D-j,w),g||(f.r=7&w|x[w/8|0]<<3,w-=7,f.h=T,f.p=C,f.i=D,f.w=z)}else{for(D=f.w||0;D<d+g;D+=65535){var ot=D+65535;ot>=d&&(x[w/8|0]=g,ot=d),w=k(x,w+1,t.subarray(D,ot))}f.i=d}return _(m,0,h+y(w)+a)}(t,null==o.level?6:o.level,null==o.mem?a.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):20:12+o.mem,l,h,a)}(t,this.o,0,0,this.s),o)},t.prototype.push=function(t,n){this.ondata||b(5),this.s.l&&b(4);var r=t.length+this.s.z;if(r>this.b.length){if(r>2*this.b.length-32768){var i=new e(-32768&r);i.set(this.b.subarray(0,this.s.z)),this.b=i}var s=this.b.length-this.s.z;this.b.set(t.subarray(0,s),this.s.z),this.s.z=this.b.length,this.p(this.b,!1),this.b.set(this.b.subarray(-32768)),this.b.set(t.subarray(s),32768),this.s.z=t.length-s+32768,this.s.i=32766,this.s.w=32768}else this.b.set(t,this.s.z),this.s.z+=t.length;this.s.l=1&n,(this.s.z>this.s.w+8191||n)&&(this.p(this.b,n||!1),this.s.w=this.s.i,this.s.i-=2)},t.prototype.flush=function(){this.ondata||b(5),this.s.l&&b(4),this.p(this.b,!1),this.s.w=this.s.i,this.s.i-=2},t}(),D="undefined"!=typeof TextEncoder&&new TextEncoder,O="undefined"!=typeof TextDecoder&&new TextDecoder;try{O.decode(N,{stream:!0})}catch(t){}function z(t,n){if(n){for(var r=new e(t.length),i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}if(D)return D.encode(t);var s=t.length,o=new e(t.length+(t.length>>1)),l=0,h=function(t){o[l++]=t};for(i=0;i<s;++i){if(l+5>o.length){var a=new e(l+8+(s-i<<1));a.set(o),o=a}var u=t.charCodeAt(i);u<128||n?h(u):u<2048?(h(192|u>>6),h(128|63&u)):u>55295&&u<57344?(h(240|(u=65536+(1047552&u)|1023&t.charCodeAt(++i))>>18),h(128|u>>12&63),h(128|u>>6&63),h(128|63&u)):(h(224|u>>12),h(128|u>>6&63),h(128|63&u))}return _(o,0,l)}var j=function(t){var e=0;if(t)for(var n in t){var r=t[n].length;r>65535&&b(9),e+=r+4}return e},W=function(t,e,n,r,i,s,o,l){var h=r.length,a=n.extra,u=l&&l.length,c=j(a);E(t,e,null!=o?33639248:67324752),e+=4,null!=o&&(t[e++]=20,t[e++]=n.os),t[e]=20,e+=2,t[e++]=n.flag<<1|(s<0&&8),t[e++]=i&&8,t[e++]=255&n.compression,t[e++]=n.compression>>8;var f=new Date(null==n.mtime?Date.now():n.mtime),d=f.getFullYear()-1980;if((d<0||d>119)&&b(10),E(t,e,d<<25|f.getMonth()+1<<21|f.getDate()<<16|f.getHours()<<11|f.getMinutes()<<5|f.getSeconds()>>1),e+=4,-1!=s&&(E(t,e,n.crc),E(t,e+4,s<0?-s-2:s),E(t,e+8,n.size)),E(t,e+12,h),E(t,e+14,c),e+=16,null!=o&&(E(t,e,u),E(t,e+6,n.attrs),E(t,e+10,o),e+=14),t.set(r,e),e+=h,c)for(var m in a){var x=a[m],g=x.length;E(t,e,+m),E(t,e+2,g),t.set(x,e+4),e+=4+g}return u&&(t.set(l,e),e+=u),e},X=function(){function t(t){var e;this.filename=t,this.c=(e=-1,{p:function(t){for(var n=e,r=0;r<t.length;++r)n=P[255&n^t[r]]^n>>>8;e=n},d:function(){return~e}}),this.size=0,this.compression=0}return t.prototype.process=function(t,e){this.ondata(null,t,e)},t.prototype.push=function(t,e){this.ondata||b(5),this.c.p(t),this.size+=t.length,e&&(this.crc=this.c.d()),this.process(t,e||!1)},t}(),B=function(){function t(t,e){var n,r=this;e||(e={}),X.call(this,t),this.d=new U(e,function(t,e){r.ondata(null,t,e)}),this.compression=8,this.flag=1==(n=e.level)?3:n<6?2:9==n?1:0}return t.prototype.process=function(t,e){try{this.d.push(t,e)}catch(t){this.ondata(t,null,e)}},t.prototype.push=function(t,e){X.prototype.push.call(this,t,e)},t}(),H=function(){function t(t){this.ondata=t,this.u=[],this.d=1}return t.prototype.add=function(t){var n=this;if(this.ondata||b(5),2&this.d)this.ondata(b(4+8*(1&this.d),0,1),null,!1);else{var r=z(t.filename),i=r.length,s=t.comment,o=s&&z(s),l=i!=t.filename.length||o&&s.length!=o.length,h=i+j(t.extra)+30;i>65535&&this.ondata(b(11,0,1),null,!1);var a=new e(h);W(a,0,t,r,l,-1);var u=[a],c=function(){for(var t=0,e=u;t<e.length;t++){var r=e[t];n.ondata(null,r,!1)}u=[]},f=this.d;this.d=0;var d=this.u.length,m=function(t,e){var n={};for(var r in t)n[r]=t[r];for(var r in e)n[r]=e[r];return n}(t,{f:r,u:l,o:o,t:function(){t.terminate&&t.terminate()},r:function(){if(c(),f){var t=n.u[d+1];t?t.r():n.d=1}f=1}}),x=0;t.ondata=function(r,i,s){if(r)n.ondata(r,i,s),n.terminate();else if(x+=i.length,u.push(i),s){var o=new e(16);E(o,0,134695760),E(o,4,t.crc),E(o,8,x),E(o,12,t.size),u.push(o),m.c=x,m.b=h+x+16,m.crc=t.crc,m.size=t.size,f&&m.r(),f=1}else f&&c()},this.u.push(m)}},t.prototype.end=function(){var t=this;2&this.d?this.ondata(b(4+8*(1&this.d),0,1),null,!0):(this.d?this.e():this.u.push({r:function(){1&t.d&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3)},t.prototype.e=function(){for(var t=0,n=0,r=0,i=0,s=this.u;i<s.length;i++)r+=46+(m=s[i]).f.length+j(m.extra)+(m.o?m.o.length:0);for(var o,l,h,a,u,c=new e(r+22),f=0,d=this.u;f<d.length;f++){var m=d[f];W(c,t,m,m.f,m.u,-m.c-2,n,m.o),t+=46+m.f.length+j(m.extra)+(m.o?m.o.length:0),n+=m.b}o=c,l=t,h=this.u.length,a=r,u=n,E(o,l,101010256),E(o,l+8,h),E(o,l+10,h),E(o,l+12,a),E(o,l+16,u),this.ondata(null,c,!0),this.d=2},t.prototype.terminate=function(){for(var t=0,e=this.u;t<e.length;t++)e[t].t();this.d=2},t}();const q="object"==typeof window?window:globalThis;let G=null,L=!1;const V=q.WebStreamsPolyfill||{},J=q.isSecureContext;let K=!0;const Q=J||"undefined"!=typeof document&&"MozAppearance"in document.documentElement.style?"iframe":"navigate",Y={createWriteStream:function(t,e,n){let r={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},i=0,s=null,o=null,l=null;if(Number.isFinite(e)?([n,e]=[e,n],r.size=n,r.writableStrategy=e):e&&e.highWaterMark?(r.size=n,r.writableStrategy=e):r=e||{},!K){G||(G=J?Z(Y.mitm):function(t){const e=document.createDocumentFragment(),n={frame:q.open(t,"popup","width=200,height=100"),loaded:!1,isIframe:!1,isPopup:!0,remove(){n.frame.close()},addEventListener(...t){e.addEventListener(...t)},dispatchEvent(...t){e.dispatchEvent(...t)},removeEventListener(...t){e.removeEventListener(...t)},postMessage(...t){n.frame.postMessage(...t)}},r=t=>{t.source===n.frame&&(n.loaded=!0,q.removeEventListener("message",r),n.dispatchEvent(new Event("load")))};return q.addEventListener("message",r),n}(Y.mitm)),o=new MessageChannel,t=encodeURIComponent(t.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const e={transferringReadable:L,pathname:r.pathname||Math.random().toString().slice(-6)+"/"+t,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+t}};r.size&&(e.headers["Content-Length"]=r.size);const n=[e,"*",[o.port2]];if(L){const t="iframe"===Q?void 0:{transform(t,e){if(!(t instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");i+=t.length,e.enqueue(t),s&&(location.href=s,s=null)},flush(){s&&(location.href=s)}};l=new Y.TransformStream(t,r.writableStrategy,r.readableStrategy);const e=l.readable;o.port1.postMessage({readableStream:e},[e])}o.port1.onmessage=t=>{t.data.download?"navigate"===Q?(G.remove(),G=null,i?location.href=t.data.download:s=t.data.download):(G.isPopup&&(G.remove(),G=null,"iframe"===Q&&Z(Y.mitm)),Z(t.data.download)):t.data.abort&&(h=[],o.port1.postMessage("abort"),o.port1.onmessage=null,o.port1.close(),o.port2.close(),o=null)},G.loaded?G.postMessage(...n):G.addEventListener("load",()=>{G.postMessage(...n)},{once:!0})}let h=[];return!K&&l&&l.writable||new Y.WritableStream({write(t){if(!(t instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");K?h.push(t):(o.port1.postMessage(t),i+=t.length,s&&(location.href=s,s=null))},close(){if(K){const e=new Blob(h,{type:"application/octet-stream; charset=utf-8"}),n=document.createElement("a");n.href=URL.createObjectURL(e),n.download=t,n.click()}else o.port1.postMessage("end")},abort(){h=[],o.port1.postMessage("abort"),o.port1.onmessage=null,o.port1.close(),o.port2.close(),o=null}},r.writableStrategy)},WritableStream:q.WritableStream||V.WritableStream,supported:!0,version:{full:"2.0.6",major:2,minor:0,dot:6},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0",configure(t={}){!0===t.useStreamDownload?(K=!1,t.streamMitmUrl&&(this.mitm=t.streamMitmUrl)):K=!0}};function Z(t){if(!t)throw new Error("meh");const e=document.createElement("iframe");return e.hidden=!0,e.src=t,e.loaded=!1,e.name="iframe",e.isIframe=!0,e.postMessage=(...t)=>e.contentWindow.postMessage(...t),e.addEventListener("load",()=>{e.loaded=!0},{once:!0}),document.body.appendChild(e),e}try{new Response(new ReadableStream),J&&!("serviceWorker"in navigator)&&(K=!0)}catch(b){K=!0}(()=>{try{(()=>{const{readable:t}=new TransformStream,e=new MessageChannel;e.port1.postMessage(t,[t]),e.port1.close(),e.port2.close(),L=!0,Object.defineProperty(Y,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})})()}catch(t){}})();var tt=Y;const et=1e7,nt={cache:{},numToCol(t){if(this.cache[t])return this.cache[t];let e="",n=t;for(;n>0;)n--,e=String.fromCharCode(65+n%26)+e,n=Math.floor(n/26);return this.cache[t]=e,e},encodeAddress(t,e){return this.numToCol(e)+t}};function rt(t){return"string"!=typeof t?String(t):t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}function it(){return"undefined"!=typeof performance&&performance.memory?{usedHeap:(performance.memory.usedJSHeapSize/1024/1024).toFixed(1),totalHeap:(performance.memory.totalJSHeapSize/1024/1024).toFixed(1),limit:(performance.memory.jsHeapSizeLimit/1024/1024).toFixed(0)}:null}function st(t){if(!t)return null;let e=String(t).trim().toLowerCase();const n={black:"#000000",white:"#FFFFFF",red:"#FF0000",green:"#008000",blue:"#0000FF",yellow:"#FFFF00",cyan:"#00FFFF",magenta:"#FF00FF",gray:"#808080",grey:"#808080",silver:"#C0C0C0",maroon:"#800000",olive:"#808000",lime:"#00FF00",aqua:"#00FFFF",teal:"#008080",navy:"#000080",fuchsia:"#FF00FF",purple:"#800080",orange:"#FFA500"};if(n[e])return n[e];if(e.startsWith("#")&&(e=e.substring(1).toUpperCase(),3===e.length&&(e=e.split("").map(t=>t+t).join("")),6===e.length))return"#"+e;const r=e.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i);if(r){const t=t=>parseInt(t,10).toString(16).padStart(2,"0").toUpperCase();return`#${t(r[1])}${t(r[2])}${t(r[3])}`}return null}function ot(t){const e=st(t);return e?`<color rgb="FF${e.replace("#","").toUpperCase()}"/>`:'<color rgb="FF000000"/>'}function lt(t,e=null){return e&&e>0?`<row r="${t}" ht="${e}" customHeight="1">`:`<row r="${t}">`}class ht{constructor(){this.fillMap=new Map,this.fillMap.set("none",0),this.fillMap.set("gray125",1),this.hasBorder=!1,this.hasTextFormat=!1,this.styleMap=new Map,this.styleMap.set("default",0),this.styleMap.set("wrap",1),this.nextFillId=2,this.nextStyleId=2}colorToArgb(t){const e=st(t);return e?"FF"+e.replace("#","").toUpperCase():null}getFillId(t){if(!t)return 0;const e=this.colorToArgb(t);if(!e)return 0;if(this.fillMap.has(e))return this.fillMap.get(e);const n=this.nextFillId++;return this.fillMap.set(e,n),n}getStyleId(t,e=!1){if(!t||"object"!=typeof t)return 1;const n=t.fill||t.bgColor||t.backgroundColor,r=!0===t.border,i=t.align||t.horizontalAlign||null,s=t.valign||t.verticalAlign||null,o=e;if(!(n||r||i||s||o))return 1;r&&(this.hasBorder=!0),o&&(this.hasTextFormat=!0);const l=this.getFillId(n),h=r?1:0,a=o?49:0,u=`fill_${l}_border_${h}_align_${i||"default"}_valign_${s||"default"}_numFmt_${a}`;if(this.styleMap.has(u))return this.styleMap.get(u).id;const c=this.nextStyleId++;return this.styleMap.set(u,{id:c,fillId:l,borderId:h,align:i,valign:s,numFmtId:a}),c}generateStylesXml(){const t=["<fill><patternFill patternType=_xd([52,53,52,63])/></fill>","<fill><patternFill patternType=_xd([61,40,59,35,107,104,111])/></fill>"],e=Array.from(this.fillMap.entries()).filter(([t])=>"none"!==t&&"gray125"!==t).sort((t,e)=>t[1]-e[1]);for(const[n]of e)t.push(`<fill><patternFill patternType=_xd([41,53,54,51,62])><fgColor rgb="${n}"/><bgColor indexed="64"/></patternFill></fill>`);const n=`<fills count="${t.length}">${t.join("")}</fills>`,r=[_xd([102,56,53,40,62,63,40,100,102,54,63,60,46,117,100,102,40,51,61,50,46,117,100,102,46,53,42,117,100,102,56,53,46,46,53,55,117,100,102,62,51,59,61,53,52,59,54,117,100,102,117,56,53,40,62,63,40,100])];this.hasBorder&&r.push('<border><left style="thin"><color auto="1"/></left><right style="thin"><color auto="1"/></right><top style="thin"><color auto="1"/></top><bottom style="thin"><color auto="1"/></bottom><diagonal/></border>');const i=`<borders count="${r.length}">${r.join("")}</borders>`,s=this.hasTextFormat?'<numFmts count="1"><numFmt numFmtId="49" formatCode="@"/></numFmts>':"",o=['<xf numFmtId="0" fontId="0" fillId="0" borderId="0" xfId="0"/>','<xf numFmtId="0" fontId="0" fillId="0" borderId="0" xfId="0" applyAlignment="1"><alignment wrapText="1" vertical="center"/></xf>'],l=Array.from(this.styleMap.entries()).filter(([t])=>"default"!==t&&"wrap"!==t).sort((t,e)=>t[1].id-e[1].id);for(const[,t]of l){const e=t.numFmtId||0,n=e>0?' applyNumberFormat="1"':"",r=t.fillId>0?' applyFill="1"':"",i=t.borderId>0?' applyBorder="1"':"";let s='wrapText="1"';t.align&&(s+=` horizontal="${t.align}"`),s+=` vertical="${t.valign&&"default"!==t.valign?t.valign:"center"}"`,o.push(`<xf numFmtId="${e}" fontId="0" fillId="${t.fillId||0}" borderId="${t.borderId||0}" xfId="0"${n}${r}${i} applyAlignment="1"><alignment ${s}/></xf>`)}return`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<styleSheet xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52])>\n${s}\n<fonts count="1"><font><sz val="11"/><name val="Calibri"/></font></fonts>\n${n}\n${i}\n<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>\n<cellXfs count="${o.length}">${o.join("")}</cellXfs>\n</styleSheet>`}}function at(t){let e=t.replace(/<(td|th|tr|table|tbody|thead|tfoot)(\s|>)/gi,_xd([102,41,42,59,52,126,104])).replace(/<\/(td|th|tr|table|tbody|thead|tfoot)>/gi,_xd([102,117,41,42,59,52,100]));return(new DOMParser).parseFromString(e,"text/html").body.childNodes}function ut(t,e={}){let n="";return t.forEach(t=>{if(t.nodeType===Node.TEXT_NODE){const r=t.textContent;if(r){const t=function(t){const e={"font-weight":t=>"bold"===t?_xd([102,56,117,100]):"","font-style":t=>"italic"===t?_xd([102,51,117,100]):"",color:t=>ot(t),"text-decoration":t=>{let e="";return t.includes("underline")&&(e+='<u val="single"/>'),t.includes("line-through")&&(e+=_xd([102,41,46,40,51,49,63,117,100])),e},"font-size":t=>{let e=parseFloat(t);return t.includes("pt")?e=parseFloat(t):t.includes("px")&&(e=.75*parseFloat(t)),`<sz val="${e}"/>`},"font-family":t=>`<rFont val="${t}"/>`};let n=_xd([102,40,10,40,100]);for(let r in t)e[r]&&(n+=e[r](t[r]));const r=t["font-size"],i=t["font-family"];return r&&!i&&(n+='<rFont val="宋体"/>'),n+=_xd([102,117,40,10,40,100]),n}(e);n+=`<r>${t}<t xml:space="preserve">${rt(r)}</t></r>`}}else if(t.nodeType===Node.ELEMENT_NODE){const r=t.tagName.toLowerCase(),i=t.getAttribute("style")||"";let s={...e};if(s=function(t,e){return e?(e.split(";").filter(t=>""!==t.trim()).forEach(e=>{const[n,r]=e.split(":").map(t=>t.trim());n&&r&&(t[n]=r)}),t):t}(s,i),"b"===r||"strong"===r)s["font-weight"]="bold";else if("i"===r||"em"===r)s["font-style"]="italic";else if("u"===r)s["text-decoration"]=(s["text-decoration"]||"")+" underline";else if("s"===r||"del"===r||"strike"===r)s["text-decoration"]=(s["text-decoration"]||"")+" line-through";else if("br"===r)return void(n+='<r><rPr/><t xml:space="preserve">\n</t></r>');n+=ut(t.childNodes,s)}}),n}function ct(t){return"string"==typeof t&&/<[^>]+>/.test(t)}function ft(t){return t&&(t.color||t.bold||t.italic||t.underline||t.strikethrough||t.strike||t.fontSize||t.fontFamily)}function dt(t){let e=_xd([102,40,10,40,100]);return t.bold&&(e+=_xd([102,56,117,100])),t.italic&&(e+=_xd([102,51,117,100])),t.underline&&(e+='<u val="single"/>'),(t.strikethrough||t.strike)&&(e+=_xd([102,41,46,40,51,49,63,117,100])),t.color&&(e+=ot(t.color)),t.fontSize&&(e+=`<sz val="${t.fontSize}"/>`),t.fontFamily?e+=`<rFont val="${t.fontFamily}"/>`:t.fontSize&&(e+='<rFont val="宋体"/>'),e+=_xd([102,117,40,10,40,100]),e}const mt={name:"richtext",processValue(t,e){if(ct(t)){const n=at(t),r=function(t){if(!t)return{};const e={};return t.fontSize&&(e["font-size"]=`${t.fontSize}pt`),t.fontFamily&&(e["font-family"]=t.fontFamily),t.bold&&(e["font-weight"]="bold"),t.italic&&(e["font-style"]="italic"),t.underline&&(e["text-decoration"]="underline"),(t.strikethrough||t.strike)&&(e["text-decoration"]=(e["text-decoration"]||"")+" line-through"),t.color&&(e.color=t.color),e}(e);return{isRichText:!0,content:ut(n,r)}}return ft(e)?{isRichText:!0,content:`<r>${dt(e)}<t xml:space="preserve">${rt(String(t))}</t></r>`}:{isRichText:!1,content:rt(String(t))}}};function xt(){return""}function gt(){return""}function wt(t){return t?t.replace(/\.(xlsx?|xls|xlsm|csv)$/i,"")+".xlsx":"export.xlsx"}class vt{constructor(){this.m=null,this.v={get height(){return null},set height(t){}}}setRow(){return{height:null}}getRow(){return null}getHeight(){return this.m}getHeaderHeight(){return null}getDefaultConfig(){return this.v}clear(){return this}}class pt{constructor(){this._=10;const t=this;this.v={get width(){return t._},set width(t){}}}setCol(){return{width:null}}getCol(){return null}getWidth(){return this._}fromArray(){return this}getMaxCol(){return 0}getDefaultConfig(){return this.v}generateColsXml(t){if(0===t)return"";let e=_xd([102,57,53,54,41,100]);for(let n=1;n<=t;n++)e+=`<col min="${n}" max="${n}" width="${this._}" customWidth="1"/>`;return e+=_xd([102,117,57,53,54,41,100]),e}clear(){return this}}class yt{constructor(){this.images=[]}hasImages(){return!1}hasImagesForSheet(){return!1}getContentTypesAdditions(){return{extensions:[],overrides:[]}}generateDrawingXml(){return""}generateDrawingRelsXml(){return""}generateSheetDrawingRel(){return""}getImageBinary(){return null}getExtension(){return"png"}clear(){this.images=[]}addImage(){return-1}}function _t(t){if(!t||0===t.length)return"";let e=`<mergeCells count="${t.length}">`;for(const n of t){let t,r,i,s;Array.isArray(n)?[t,r,i,s]=n:void 0!==n.y?(t=n.y,r=n.x,i=t+(n.h||1)-1,s=r+(n.w||1)-1):(t=n.startRow,r=n.startCol,i=n.endRow,s=n.endCol),e+=`<mergeCell ref="${nt.encodeAddress(t,r)}:${nt.encodeAddress(i,s)}"/>`}return e+=_xd([102,117,55,63,40,61,63,25,63,54,54,41,100]),e}function $t(t,e,n,r,i,s,o){const l=nt.encodeAddress(t,e);if("object"!=typeof n||null===n)return`<c r="${l}" t=_xd([51,52,54,51,52,63,9,46,40]) s="${r.getStyleId(n)}"><is><t>${rt(String(n||""))}</t></is></c>`;if("img"===n.type&&n.imageUrl&&o){const i=r.getStyleId(n),s=n.merge||{},h=s.rowSpan||n.rowSpan||1,a=s.colSpan||n.colSpan||1;return o.addImage({data:n.imageUrl,row:t,col:e,width:n.width||80,height:n.height||80,rowSpan:h,colSpan:a,editAs:n.editAs||_xd([53,52,63,25,63,54,54]),sheetIndex:1}),`<c r="${l}" s="${i}"/>`}n.link&&i&&i.push({row:t,col:e,url:n.link,tooltip:n.linkTooltip||""});const h=n.value??"";if("number"==typeof h&&!isNaN(h))return`<c r="${l}" s="${r.getStyleId(n)}"><v>${h}</v></c>`;const a=(s||mt).processValue(h,n),u=r.getStyleId(n,a.isRichText);return a.isRichText?`<c r="${l}" t=_xd([51,52,54,51,52,63,9,46,40]) s="${u}"><is>${a.content}</is></c>`:`<c r="${l}" t=_xd([51,52,54,51,52,63,9,46,40]) s="${u}"><is><t>${a.content}</t></is></c>`}class bt{constructor(){this.plugins=[]}use(t){return t&&t.name&&!this.plugins.find(e=>e.name===t.name)&&this.plugins.push(t),this}async export(t){const{worksheets:e,dataSource:n,mergeArr:r,onProgress:i,fileName:s="export.xlsx",rowConfig:o,colConfig:l,imageManager:h,richtextProcessor:a,hyperlinkXmlGenerator:u,hyperlinkRelsGenerator:c,workSheetMaxRowsNum:f=1e6}=t,d=wt(s),m=u||xt,x=c||gt,g=i||(()=>{});g(0,"init","开始导出...",it());const w=new ht,v=Math.min(f,et);let p;if(e&&e.length>0)p=e;else{if(!n||!n.getPageData)throw new Error("必须提供工作表配置");p=[{name:"Sheet1",dataSource:n,mergeArr:r,rowConfig:o||new vt,colConfig:l||new pt,imageManager:h||new yt}]}let y=0;const _=[];let $=!1;for(const t of p){const e=t.dataSource,n=e.totalRows;if(-1===n)$=!0,_.push({name:t.name,dataSource:e,columnCount:t.columnCount||e.headerRow?.length||0,mergeArr:t.mergeArr,rowConfig:t.rowConfig||new vt,colConfig:t.colConfig||new pt,imageManager:t.imageManager||new yt,startRow:0,endRow:1/0,isStreamMode:!0});else{y+=n;const r=Math.ceil(n/v);for(let i=0;i<r;i++){const s=r>1?`${t.name}_${i+1}`:t.name;_.push({name:s,dataSource:e,columnCount:t.columnCount||e.headerRow?.length||0,mergeArr:0===i?t.mergeArr:null,rowConfig:t.rowConfig||new vt,colConfig:t.colConfig||new pt,imageManager:t.imageManager||new yt,startRow:i*v,endRow:Math.min((i+1)*v,n),isStreamMode:!1})}}}const b=_.length;g(2,"init",$?`导出模式，${b} 个工作表`:`共 ${y.toLocaleString()} 行，${b} 个工作表`,it());const C=tt.createWriteStream(d).getWriter(),T=new TextEncoder;let F=0,M=0;return new Promise((t,e)=>{const n=new H((n,r,i)=>{if(n)return C.abort(),void e(n);C.write(r).then(()=>{F+=r.length,i&&C.close().then(()=>{const e=(F/1024/1024).toFixed(2);g(100,"done",`导出完成！共 ${M} 行，文件大小: ${e}MB`,it()),t({success:!0,rows:M,sheets:b,sizeMB:e})})})});(async()=>{try{let t="";for(let e=1;e<=b;e++)t+=`  <Override PartName="/xl/worksheets/sheet${e}.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,45,53,40,49,41,50,63,63,46,113,34,55,54])/>\n`;let e="",r="";const i=new Set,s=[];for(const t of _)if(t.imageManager&&t.imageManager.hasImages()){const e=t.imageManager.getContentTypesAdditions();e.extensions.forEach(t=>i.add(t)),s.push(...e.overrides)}i.size>0&&(e=[...i].map(t=>"  "+t).join("\n")+"\n"),s.length>0&&(r=s.map(t=>"  "+t).join("\n")+"\n");const o=new B("[Content_Types].xml",{level:6});n.add(o),o.push(T.encode(`<?xml version="1.0"?>\n<Types xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,57,53,52,46,63,52,46,119,46,35,42,63,41])>\n  <Default Extension="xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,34,55,54])/>\n  <Default Extension="rels" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,42,59,57,49,59,61,63,116,40,63,54,59,46,51,53,52,41,50,51,42,41,113,34,55,54])/>\n${e}  <Override PartName="/xl/workbook.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,50,63,63,46,116,55,59,51,52,113,34,55,54])/>\n${t}${r}  <Override PartName="/xl/styles.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,46,35,54,63,41,113,34,55,54])/>\n</Types>`),!0),g(3,"building","写入元数据...",it());const l=new B("_rels/.rels",{level:6});n.add(l),l.push(T.encode('<?xml version="1.0"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <Relationship Id="rId1" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46]) Target=_xd([34,54,117,45,53,40,49,56,53,53,49,116,34,55,54])/>\n</Relationships>'),!0);let h="";for(let t=0;t<b;t++)h+=`    <sheet name="${rt(_[t].name)}" sheetId="${t+1}" r:id="rId${t+1}"/>\n`;const u=new B("xl/workbook.xml",{level:6});n.add(u),u.push(T.encode(`<?xml version="1.0"?>\n<workbook xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) xmlns:r=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <sheets>\n${h}  </sheets>\n</workbook>`),!0);let c="";for(let t=1;t<=b;t++)c+=`  <Relationship Id="rId${t}" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,45,53,40,49,41,50,63,63,46]) Target=_xd([45,53,40,49,41,50,63,63,46,41,117,41,50,63,63,46,126,33,51,39,116,34,55,54])/>\n`;const f=b+1,d=new B("xl/_rels/workbook.xml.rels",{level:6});n.add(d),d.push(T.encode(`<?xml version="1.0"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n${c}  <Relationship Id="rId${f}" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,41,46,35,54,63,41]) Target=_xd([41,46,35,54,63,41,116,34,55,54])/>\n</Relationships>`),!0),g(5,"building","开始写入数据...",it());for(let t=0;t<b;t++){const e=_[t],r=t+1,{dataSource:i,columnCount:s,mergeArr:o,rowConfig:l,colConfig:h,imageManager:u,startRow:c,endRow:f}=e,{headerRow:d,getPageData:v,pageSize:p}=i,$=s||d?.length||0,C=Math.min(p||1e3,1e3),F=f-c;g(5+t/b*85,"building",`正在写入工作表 ${e.name} (${r}/${b})...`,it());const S=new B(`xl/worksheets/sheet${r}.xml`,{level:6});n.add(S);let I=`<?xml version="1.0" encoding="UTF-8"?>\n<worksheet xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) xmlns:r=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n${h.generateColsXml($)}\n<sheetData>`;S.push(T.encode(I),!1);let k=1,R=0;const A=[];let N=c;if(d){let t=lt(k,l.getHeaderHeight());for(let e=1;e<=$;e++)t+=$t(k,e,d[e-1],w,A,a,u);t+=_xd([102,117,40,53,45,100,6,52]),S.push(T.encode(t),!1),k++}const P=100,E=e.isStreamMode;for(;E||!(R>=F||N>=f);){let t;if(E)t=await v();else{const e=Math.floor(N/C),n=N%C;t=await v(e,C),t&&n>0&&(t=t.slice(n))}if(!t||0===t.length)break;let n="",r=0;for(let e=0;e<t.length&&(E||!(R>=F));e++){const i=t[e];let s=lt(k,l.getHeight(k));for(let t=1;t<=$;t++)s+=$t(k,t,i[t-1],w,A,a,u);s+=_xd([102,117,40,53,45,100,6,52]),n+=s,k++,R++,N++,M++,r++,r>=P&&(S.push(T.encode(n),!1),n="",r=0)}n&&S.push(T.encode(n),!1),g(E?Math.min(90,5+Math.floor(M/1e3)):Math.round(5+M/y*85),"building",`工作表 ${e.name}，已写入 ${M.toLocaleString()} 行`,it()),await new Promise(t=>setTimeout(t,0))}let U=_xd([102,117,41,50,63,63,46,30,59,46,59,100,6,52]);o&&o.length>0&&(U+=_t(o)),A.length>0&&(U+="\n"+m(A)),u.hasImagesForSheet(r)&&(U+='\n<drawing r:id="rId1"/>'),U+="\n</worksheet>",S.push(T.encode(U),!0);const D=u.hasImagesForSheet(r),O=A.filter(t=>!t.url.startsWith("#"));if(D||O.length>0){const t=new B(`xl/worksheets/_rels/sheet${r}.xml.rels`,{level:6});n.add(t);let e=D?u.generateSheetDrawingRel(r):"";if(O.length>0&&(e+=x(O)),t.push(T.encode(`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  ${e}\n</Relationships>`),!0),D){const t=new B(`xl/drawings/drawing${r}.xml`,{level:6});n.add(t),t.push(T.encode(u.generateDrawingXml(r)),!0);const e=new B(`xl/drawings/_rels/drawing${r}.xml.rels`,{level:6});n.add(e),e.push(T.encode(u.generateDrawingRelsXml(r)),!0)}}}g(92,"building","写入样式...",it());const v=new B("xl/styles.xml",{level:6});if(n.add(v),v.push(T.encode(w.generateStylesXml()),!0),_.some(t=>t.imageManager&&t.imageManager.hasImages())){g(93,"building","写入图片...",it());for(const t of _)if(t.imageManager&&t.imageManager.hasImages())for(const e of t.imageManager.images){const r=t.imageManager.getImageBinary(e.id);if(r){const i=new B(`xl/media/image${e.id}.${t.imageManager.getExtension(e.type)}`,{level:6});n.add(i),i.push(r,!0)}}}g(95,"compressing","完成压缩...",it()),n.end()}catch(t){C.abort(),g(0,"error",`导出失败: ${t.message}`,it()),e(t)}})()})}}class Ct{constructor(){this.$=null,this.C=null,this.T=new TextEncoder,this.F=null,this.M=0,this.S=0,this.I=0,this.k=!1,this.R=new ht,this.A=0,this.N=null,this.P=[],this.U=null,this.D=null,this.O=null,this.j="export.xlsx",this.W=[],this.X=0,this.B=[],this.H=null,this.q=new Map}async init(t){if(this.k)return;const{fileName:e="export.xlsx",onProgress:n}=t;this.j=wt(e),this.U=n||(()=>{}),this.U(0,"init","初始化导出...",it());const r=tt.createWriteStream(this.j);return this.C=r.getWriter(),new Promise((t,e)=>{this.D=t,this.O=e,this.$=new H((t,n,r)=>{if(t)return this.C.abort(),void e(t);this.C.write(n).then(()=>{this.I+=n.length,r&&this.C.close().then(()=>{const t=(this.I/1024/1024).toFixed(2),e=this.W?.length||1;this.U(100,"done",`导出完成！共 ${this.S} 行，${e} 个工作表，文件大小: ${t}MB`,it()),this.G&&this.G({success:!0,rows:this.S,sheets:e,sizeMB:t})})})}),this.k=!0,t()})}async beginSheet(t){if(!this.k)throw new Error("请先调用 init() 初始化流");const{sheetName:e=`Sheet${this.W.length+1}`,headerRow:n,columns:r,rowConfig:i,colConfig:s,mergeArr:o,imageManager:l}=t,h={name:e,mergeArr:o||[],imageManager:l||new yt,columns:r||n?.length||10,rowConfig:i||new vt,colConfig:s||new pt};this.W.push(h),this.X=this.W.length,this.B=h.mergeArr,this.H=h.imageManager,this.M=0,this.A=h.columns,this.N=h.rowConfig,this.L=h.colConfig,this.q.clear();const a=this.T;this.F=new B(`xl/worksheets/sheet${this.X}.xml`,{level:6}),this.$.add(this.F);let u="";if(this.L&&this.L.generateColsXml&&(u=this.L.generateColsXml(this.A)),this.F.push(a.encode(`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<worksheet xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) xmlns:r=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n${u}<sheetData>\n`),!1),n&&n.length>0){this.M=1;let t=lt(1,this.N.getHeaderHeight?.()||this.N.getHeight?.(1)),e=1,r=0,i=null;for(let s=0;s<n.length;s++){const o=n[s];e<r?(t+=$t(1,e,{value:"",border:i?.border,fill:i?.fill,bgColor:i?.bgColor,backgroundColor:i?.backgroundColor},this.R,this.P,mt,this.H),e++):(t+=$t(1,e,o,this.R,this.P,mt,this.H),e++,o&&o.merge&&o.merge.colSpan>1?(r=e+o.merge.colSpan-1,i=o):i=null)}for(;e<=r&&i;)t+=$t(1,e,{value:"",border:i?.border,fill:i?.fill,bgColor:i?.bgColor,backgroundColor:i?.backgroundColor},this.R,this.P,mt,this.H),e++;t+=_xd([102,117,40,53,45,100,6,52]),this.F.push(a.encode(t),!1)}this.U(5,"building",`开始写入工作表: ${e}`,it())}async endSheet(){if(!this.F)return;const t=this.T,e=this.W[this.X-1],n=e.imageManager&&e.imageManager.hasImages&&e.imageManager.hasImages();let r=_xd([102,117,41,50,63,63,46,30,59,46,59,100,6,52]);if(e.mergeArr&&e.mergeArr.length>0&&(r+=_t(e.mergeArr)),n&&(r+='<drawing r:id="rId1"/>\n'),r+=_xd([102,117,45,53,40,49,41,50,63,63,46,100]),this.F.push(t.encode(r),!0),this.F=null,n){const n=this.X,r=new B(`xl/worksheets/_rels/sheet${n}.xml.rels`,{level:6});this.$.add(r),r.push(t.encode('<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <Relationship Id="rId1" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,62,40,59,45,51,52,61]) Target=_xd([116,116,117,62,40,59,45,51,52,61,41,117,62,40,59,45,51,52,61,126,33,41,50,63,63,46,19,62,34,39,116,34,55,54])/>\n</Relationships>'),!0);const i=new B(`xl/drawings/drawing${n}.xml`,{level:6});this.$.add(i),i.push(t.encode(e.imageManager.generateDrawingXml(n)),!0);const s=new B(`xl/drawings/_rels/drawing${n}.xml.rels`,{level:6});this.$.add(s),s.push(t.encode(e.imageManager.generateDrawingRelsXml(n)),!0);for(const t of e.imageManager.images){const n=e.imageManager.getImageBinary(t.id);if(n){const r=new B(`xl/media/image${t.id}.${e.imageManager.getExtension(t.type)}`,{level:6});this.$.add(r),r.push(n,!0)}}}this.S+=this.M,this.U(Math.min(90,5+Math.floor(this.S/1e3)),"building",`工作表 ${e.name} 写入完成，共 ${this.M} 行`,it())}async initLegacy(t){const{fileName:e="export.xlsx",sheetName:n="Sheet1",headerRow:r,columns:i,rowConfig:s,colConfig:o,mergeArr:l,imageManager:h,onProgress:a}=t;await this.init({fileName:e,onProgress:a}),await this.beginSheet({sheetName:n,headerRow:r,columns:i,rowConfig:s,colConfig:o,mergeArr:l,imageManager:h})}V(t){const e=this.T,n=this.$;let r="",i="";if(this.J&&this.J.hasImages&&this.J.hasImages()){const t=this.J.getContentTypesAdditions();t.extensions.length>0&&(r=t.extensions.map(t=>"  "+t).join("\n")+"\n"),i='  <Override PartName="/xl/drawings/drawing1.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,62,40,59,45,51,52,61,113,34,55,54])/>\n'}const s=new B("[Content_Types].xml",{level:6});n.add(s),s.push(e.encode(`<?xml version="1.0" encoding="UTF-8"?>\n<Types xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,57,53,52,46,63,52,46,119,46,35,42,63,41])>\n  <Default Extension="rels" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,42,59,57,49,59,61,63,116,40,63,54,59,46,51,53,52,41,50,51,42,41,113,34,55,54])/>\n  <Default Extension="xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,34,55,54])/>\n${r}  <Override PartName="/xl/workbook.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,50,63,63,46,116,55,59,51,52,113,34,55,54])/>\n  <Override PartName="/xl/worksheets/sheet1.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,45,53,40,49,41,50,63,63,46,113,34,55,54])/>\n${i}  <Override PartName="/xl/styles.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,46,35,54,63,41,113,34,55,54])/>\n  <Override PartName="/xl/sharedStrings.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,50,59,40,63,62,9,46,40,51,52,61,41,113,34,55,54])/>\n</Types>`),!0);const o=new B("_rels/.rels",{level:6});n.add(o),o.push(e.encode('<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <Relationship Id="rId1" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46]) Target=_xd([34,54,117,45,53,40,49,56,53,53,49,116,34,55,54])/>\n</Relationships>'),!0);const l=new B("xl/_rels/workbook.xml.rels",{level:6});n.add(l),l.push(e.encode('<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <Relationship Id="rId1" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,45,53,40,49,41,50,63,63,46]) Target=_xd([45,53,40,49,41,50,63,63,46,41,117,41,50,63,63,46,107,116,34,55,54])/>\n  <Relationship Id="rId2" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,41,46,35,54,63,41]) Target=_xd([41,46,35,54,63,41,116,34,55,54])/>\n  <Relationship Id="rId3" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,41,50,59,40,63,62,9,46,40,51,52,61,41]) Target=_xd([41,50,59,40,63,62,9,46,40,51,52,61,41,116,34,55,54])/>\n</Relationships>'),!0);const h=new B("xl/workbook.xml",{level:6});n.add(h),h.push(e.encode(`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<workbook xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) xmlns:r=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <sheets><sheet name="${rt(this.K)}" sheetId="1" r:id="rId1"/></sheets>\n</workbook>`),!0);const a=new B("xl/sharedStrings.xml",{level:6});n.add(a),a.push(e.encode('<?xml version="1.0" encoding="UTF-8"?>\n<sst xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) count="0" uniqueCount="0"/>'),!0),this.F=new B("xl/worksheets/sheet1.xml",{level:6}),n.add(this.F);let u="";if(this.L&&this.L.generateColsXml&&(u=this.L.generateColsXml(this.A)),this.F.push(e.encode(`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<worksheet xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) xmlns:r=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n${u}<sheetData>\n`),!1),t&&t.length>0){this.M=1;let n=lt(1,this.N.getHeaderHeight?.()||this.N.getHeight?.(1)),r=1,i=0,s=null;for(let e=0;e<t.length;e++){const o=t[e];r<i?(n+=$t(1,r,{value:"",border:s?.border,fill:s?.fill,bgColor:s?.bgColor,backgroundColor:s?.backgroundColor},this.R,this.P,mt,this.J),r++):(n+=$t(1,r,o,this.R,this.P,mt,this.J),r++,o&&o.merge&&o.merge.colSpan>1?(i=r+o.merge.colSpan-1,s=o):s=null)}for(;r<=i&&s;)n+=$t(1,r,{value:"",border:s?.border,fill:s?.fill,bgColor:s?.bgColor,backgroundColor:s?.backgroundColor},this.R,this.P,mt,this.H),r++;n+=_xd([102,117,40,53,45,100,6,52]),this.F.push(e.encode(n),!1)}this.U(5,"building","写入就绪...",it())}async writeRows(t){if(!this.k)throw new Error("请先调用 init() 初始化流");if(!t||0===t.length)return;const e=this.T;let n="";for(let r=0;r<t.length;r++){this.M++;const i=t[r],s=this.N.getHeight?.(this.M);let o=lt(this.M,s);const l=this.H||this.J;let h=1,a=0,u=null;for(let t=0;t<i.length;t++){const e=i[t],n=this.q.get(h);if(n){if(this.M<=n.endRow){const e={value:"",border:n.style?.border,fill:n.style?.fill,bgColor:n.style?.bgColor,backgroundColor:n.style?.backgroundColor};if(o+=$t(this.M,h,e,this.R,this.P,mt,l),h++,n.colSpan>1)for(let r=1;r<n.colSpan&&t+1<i.length;r++)t++,h++,o+=$t(this.M,h-1,e,this.R,this.P,mt,l);continue}this.q.delete(h)}if(h<a){const t={value:"",border:u?.border,fill:u?.fill,bgColor:u?.bgColor,backgroundColor:u?.backgroundColor};o+=$t(this.M,h,t,this.R,this.P,mt,l),h++;continue}if(o+=$t(this.M,h,e,this.R,this.P,mt,l),e&&e.merge){const{rowSpan:t=1,colSpan:n=1}=e.merge;n>1?(a=h+n,u=e):u=null,t>1&&this.q.set(h,{endRow:this.M+t-1,colSpan:n,style:e})}else u=null;h++}for(;h<a&&u;){const t={value:"",border:u?.border,fill:u?.fill,bgColor:u?.bgColor,backgroundColor:u?.backgroundColor};o+=$t(this.M,h,t,this.R,this.P,mt,l),h++}o+=_xd([102,117,40,53,45,100,6,52]),n+=o,(r+1)%100==0&&(this.F.push(e.encode(n),!1),n="",await new Promise(t=>setTimeout(t,0)))}n&&this.F.push(e.encode(n),!1);const r=this.W[this.X-1],i=r?r.name:`Sheet${this.X}`;this.U(Math.min(90,5+Math.floor(this.M/1e3)),"building",`[${i}] 已写入 ${this.M.toLocaleString()} 行`,it())}setMergeArr(t){Array.isArray(t)&&(this.Y=t)}setImageManager(t){t&&(this.J=t)}async finish(){if(!this.k)throw new Error("请先调用 init() 初始化流");const t=this.T;if(this.W&&this.W.length>0)return this.Z();const e=this.J&&this.J.hasImages&&this.J.hasImages();let n=_xd([102,117,41,50,63,63,46,30,59,46,59,100,6,52]);if(this.Y&&this.Y.length>0&&(n+=_t(this.Y)),e&&(n+='<drawing r:id="rId1"/>\n'),n+=_xd([102,117,45,53,40,49,41,50,63,63,46,100]),this.F.push(t.encode(n),!0),e){const e=new B("xl/worksheets/_rels/sheet1.xml.rels",{level:6});this.$.add(e),e.push(t.encode('<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <Relationship Id="rId1" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,62,40,59,45,51,52,61]) Target=_xd([116,116,117,62,40,59,45,51,52,61,41,117,62,40,59,45,51,52,61,107,116,34,55,54])/>\n</Relationships>'),!0);const n=new B("xl/drawings/drawing1.xml",{level:6});this.$.add(n),n.push(t.encode(this.J.generateDrawingXml(1)),!0);const r=new B("xl/drawings/_rels/drawing1.xml.rels",{level:6});this.$.add(r),r.push(t.encode(this.J.generateDrawingRelsXml(1)),!0),this.U(92,"building","写入图片...",it());for(const t of this.J.images){const e=this.J.getImageBinary(t.id);if(e){const n=new B(`xl/media/image${t.id}.${this.J.getExtension(t.type)}`,{level:6});this.$.add(n),n.push(e,!0)}}}const r=new B("xl/styles.xml",{level:6});return this.$.add(r),r.push(t.encode(this.R.generateStylesXml()),!0),this.U(95,"compressing","完成压缩...",it()),new Promise(t=>{this.G=t,this.$.end()})}async Z(){const t=this.T,e=this.$,n=this.W,r=n.length;this.U(90,"building",`写入 ${r} 个工作表的元数据...`,it());let i=!1;const s=[];for(let t=0;t<r;t++){const e=n[t];e.imageManager&&e.imageManager.hasImages&&e.imageManager.hasImages()&&(i=!0,s.push(t+1))}let o="";if(i){const t=new Set;for(const e of n)if(e.imageManager&&e.imageManager.getContentTypesAdditions){const n=e.imageManager.getContentTypesAdditions();if(n.extensions)for(const e of n.extensions)t.add(e)}o=Array.from(t).map(t=>"  "+t).join("\n"),o&&(o+="\n")}let l="";for(const t of s)l+=`  <Override PartName="/xl/drawings/drawing${t}.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,62,40,59,45,51,52,61,113,34,55,54])/>\n`;let h="";for(let t=1;t<=r;t++)h+=`  <Override PartName="/xl/worksheets/sheet${t}.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,45,53,40,49,41,50,63,63,46,113,34,55,54])/>\n`;const a=new B("[Content_Types].xml",{level:6});e.add(a),a.push(t.encode(`<?xml version="1.0" encoding="UTF-8"?>\n<Types xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,57,53,52,46,63,52,46,119,46,35,42,63,41])>\n  <Default Extension="rels" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,42,59,57,49,59,61,63,116,40,63,54,59,46,51,53,52,41,50,51,42,41,113,34,55,54])/>\n  <Default Extension="xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,34,55,54])/>\n${o}  <Override PartName="/xl/workbook.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,50,63,63,46,116,55,59,51,52,113,34,55,54])/>\n${h}${l}  <Override PartName="/xl/styles.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,46,35,54,63,41,113,34,55,54])/>\n  <Override PartName="/xl/sharedStrings.xml" ContentType=_xd([59,42,42,54,51,57,59,46,51,53,52,117,44,52,62,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,119,53,60,60,51,57,63,62,53,57,47,55,63,52,46,116,41,42,40,63,59,62,41,50,63,63,46,55,54,116,41,50,59,40,63,62,9,46,40,51,52,61,41,113,34,55,54])/>\n</Types>`),!0);const u=new B("_rels/.rels",{level:6});e.add(u),u.push(t.encode('<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <Relationship Id="rId1" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46]) Target=_xd([34,54,117,45,53,40,49,56,53,53,49,116,34,55,54])/>\n</Relationships>'),!0);let c='<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,42,59,57,49,59,61,63,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>';for(let t=1;t<=r;t++)c+=`\n  <Relationship Id="rId${t}" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,45,53,40,49,41,50,63,63,46]) Target=_xd([45,53,40,49,41,50,63,63,46,41,117,41,50,63,63,46,126,33,51,39,116,34,55,54])/>`;c+=`\n  <Relationship Id="rId${r+1}" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,41,46,35,54,63,41]) Target=_xd([41,46,35,54,63,41,116,34,55,54])/>`,c+=`\n  <Relationship Id="rId${r+2}" Type=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41,117,41,50,59,40,63,62,9,46,40,51,52,61,41]) Target=_xd([41,50,59,40,63,62,9,46,40,51,52,61,41,116,34,55,54])/>`,c+="\n</Relationships>";const f=new B("xl/_rels/workbook.xml.rels",{level:6});e.add(f),f.push(t.encode(c),!0);let d="";for(let t=0;t<r;t++)d+=`<sheet name="${rt(n[t].name)}" sheetId="${t+1}" r:id="rId${t+1}"/>`;const m=new B("xl/workbook.xml",{level:6});e.add(m),m.push(t.encode(`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n<workbook xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) xmlns:r=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,53,60,60,51,57,63,30,53,57,47,55,63,52,46,117,104,106,106,108,117,40,63,54,59,46,51,53,52,41,50,51,42,41])>\n  <sheets>${d}</sheets>\n</workbook>`),!0);const x=new B("xl/sharedStrings.xml",{level:6});e.add(x),x.push(t.encode('<?xml version="1.0" encoding="UTF-8"?>\n<sst xmlns=_xd([50,46,46,42,96,117,117,41,57,50,63,55,59,41,116,53,42,63,52,34,55,54,60,53,40,55,59,46,41,116,53,40,61,117,41,42,40,63,59,62,41,50,63,63,46,55,54,117,104,106,106,108,117,55,59,51,52]) count="0" uniqueCount="0"/>'),!0);const g=new B("xl/styles.xml",{level:6});return e.add(g),g.push(t.encode(this.R.generateStylesXml()),!0),this.U(95,"compressing","完成压缩...",it()),new Promise(t=>{this.G=t,this.$.end()})}}function Tt(){return new Ct}class Ft{constructor(t,e,n,r={}){this.tt=t,this.et=e,this.nt=n,this.rt=null,this.Y=null,this.it=[],this.st=null,this.ot=r.columnCount||null,this.lt=null,this.ht=!1,this.ut=0,this.N=t.ct(),this.L=t.ft(),this.J=t.dt()}get name(){return this.et}get index(){return this.nt}get rowCount(){return this.it.length}get columnCount(){return this.xt()}setRow(t){return"default"===t?this.N.getDefaultConfig():this.N.setRow(t)}setCol(t){return"default"===t?this.L.getDefaultConfig():this.L.setCol(t)}setColumns(t){return this.L.fromArray(t),this}setColumnCount(t){return this.ot=t,this}xt(){if(this.ot)return this.ot;const t=this.L.getMaxCol?this.L.getMaxCol():0;let e=0;this.st&&(e=Math.max(e,this.st.length));for(const t of this.it)Array.isArray(t)&&(e=Math.max(e,t.length));const n=this.gt();return Math.max(t,e,n)}gt(){if(!this.Y||0===this.Y.length)return 0;let t=0;for(const e of this.Y){let n=0;Array.isArray(e)?n=e[3]||0:void 0!==e.endCol?n=e.endCol:void 0!==e.x&&void 0!==e.w&&(n=e.x+(e.w||1)-1),t=Math.max(t,n)}return t}setMergeCells(t){return this.Y=t,this}merge(t,e,n,r){this.Y||(this.Y=[]),t=Math.max(1,Math.floor(t)||1),e=Math.max(1,Math.floor(e)||1);const i=t+(n=Math.max(1,Math.floor(n)||1))-1,s=e+(r=Math.max(1,Math.floor(r)||1))-1;return this.Y.push([t,e,i,s]),this}wt(t){let e=0;for(let n=0;n<t.length;n++)e=26*e+(t.charCodeAt(n)-64);return e}setHeaderRow(t){return this.st=t,this}async addRow(t){return t&&"object"==typeof t&&!Array.isArray(t)||Array.isArray(t)&&await this.addRows([t]),this}async addRows(t){if(!Array.isArray(t))return this;let e=t;if(!this.ht){const n=t[0];e=t.slice(1),this.ut=1,this.vt(n,1);let r=this.ot;r||(r=this.yt(t)),(!r||r<1)&&(r=10),this.ot=r,await this.tt._t(this,n,r),this.lt=this.tt.$t,this.ht=!0}return await this.bt(e),this}async bt(t){if(!t||0===t.length)return;const e=this.tt.Ct;let n=t;for(;n.length>0;){const t=e-(this.lt.M||0);t<=0&&await this.Tt();const r=Math.min(n.length,t>0?t:e),i=n.slice(0,r);n=n.slice(r);for(const t of i)Array.isArray(t)&&(this.ut++,this.vt(t,this.ut));await this.lt.writeRows(i),n.length>0&&this.lt.M>=e&&await this.Tt()}}async Tt(){const t=this.tt,e=t.$t,n=e.W[e.X-1];n&&this.Y&&(n.mergeArr=this.Y),await e.endSheet();const r=this.et;let i=2,s=`${r}_${i}`;for(;t.Ft.has(s);)i++,s=`${r}_${i}`;t.Ft.add(s),this.Y=[],this.ut=0,await e.beginSheet({sheetName:s,headerRow:null,columns:this.ot,rowConfig:this.N,colConfig:this.L,mergeArr:this.Y,imageManager:t.dt()})}Mt(t){if(!Array.isArray(t))return 0;let e=t.length;for(let n=0;n<t.length;n++){const r=t[n];if(r&&r.merge&&r.merge.colSpan>1){const t=n+r.merge.colSpan;t>e&&(e=t)}}return e}yt(t){let e=0;for(const n of t){const t=this.Mt(n);t>e&&(e=t)}return e}vt(t,e){let n=1,r=0;for(let i=0;i<t.length;i++){const s=t[i];if(n<r)n++;else{if(s&&s.merge){const{rowSpan:t=1,colSpan:i=1}=s.merge,o=Math.max(1,Math.floor(t)||1),l=Math.max(1,Math.floor(i)||1);if(o>1||l>1){this.Y||(this.Y=[]);const t=e,i=n,s=t+o-1,h=i+l-1;this.Y.push([t,i,s,h]),r=n+l}}n++}}}setDataSource(t){return this.rt=t,this}addImage(t){return this.J.addImage(t),this}reset(){return this.rt=null,this.Y=null,this.it=[],this.st=null,this.N.clear(),this.L.clear(),this.J.clear(),this}St(){return this.rt?(this.st&&!this.rt.headerRow&&(this.rt.headerRow=this.st),this.rt):null}It(){return{name:this.et,dataSource:this.St(),columnCount:this.xt(),mergeArr:this.Y,rowConfig:this.N,colConfig:this.L,imageManager:this.J}}}class Mt{constructor(t={}){this.j=t.fileName||"export.xlsx",this.U=t.onProgress||null,this.Ct=t.workSheetMaxRowsNum||1e6,tt.configure({useStreamDownload:t.useStreamDownload||!1,streamMitmUrl:t.streamMitmUrl||null}),this.kt=[],this.Ft=new Set,this.Rt=vt,this.At=pt,this.Nt=yt,this.Pt=null,this.Et=null,this.Ut=new bt,this.Dt=!1,this.$t=null,this.Ot=null,this.zt=null}jt(t){return t.RowConfigManager&&(this.Rt=t.RowConfigManager),t.ColConfigManager&&(this.At=t.ColConfigManager),t.ImageManager&&(this.Nt=t.ImageManager),t.generateHyperlinksXml&&(this.Pt=t.generateHyperlinksXml),t.generateHyperlinkRels&&(this.Et=t.generateHyperlinkRels),this.Dt=!0,this}ct(){return new this.Rt}ft(){return new this.At}dt(){return new this.Nt}async Wt(){return this.$t||(this.$t=Tt(),await this.$t.init({fileName:this.j,onProgress:this.U})),this.$t}async _t(t,e,n){this.zt&&(await this.zt,this.zt=null);const r=await this.Wt();await r.beginSheet({sheetName:t.et,headerRow:e,columns:n,rowConfig:t.N,colConfig:t.L,mergeArr:t.Y,imageManager:t.J}),this.Ot=t}addWorkSheet(t={}){if(this.Ot&&this.$t){const t=this.$t.W[this.$t.X-1];t&&this.Ot.Y&&(t.mergeArr=this.Ot.Y),this.zt=this.$t.endSheet()}let e=t.name;if(e){let t=e,n=1;for(;this.Ft.has(e);)e=`${t}_${n}`,n++}else{let t=1;for(;this.Ft.has(`Sheet${t}`);)t++;e=`Sheet${t}`}this.Ft.add(e);const n=this.kt.length+1,r=new Ft(this,e,n,{columnCount:t.columnCount});return this.kt.push(r),this.Ot=null,r}getWorkSheets(){return[...this.kt]}getWorkSheet(t){return"number"==typeof t?this.kt[t-1]||null:this.kt.find(e=>e.name===t)||null}use(t){return this.Ut.use(t),this}setFileName(t){return this.j=t,this}onProgress(t){return this.U=t,this}get isPro(){return this.Dt}reset(){return this.kt=[],this.Ft.clear(),this}async export(t){if(0===this.kt.length)throw new Error("请先调用 addWorkSheet() 添加工作表");if(this.$t){if(this.zt&&(await this.zt,this.zt=null),this.Ot){const t=this.$t.W[this.$t.X-1];t&&this.Ot.Y&&(t.mergeArr=this.Ot.Y),await this.$t.endSheet()}return this.$t.finish()}const e=this.kt.find(t=>t.ht&&t.lt);if(e)return e.Y&&e.Y.length>0&&e.lt.setMergeArr(e.Y),e.J&&e.J.hasImages&&e.J.hasImages()&&e.lt.setImageManager(e.J),e.lt.finish();for(const t of this.kt){const e=t.St();if(!e)throw new Error(`工作表 "${t.name}" 未设置数据。请使用 addRow()/addRows() 或 setDataSource() 添加数据`);if(!e.getPageData)throw new Error(`工作表 "${t.name}" 的 dataSource 必须包含 getPageData 函数`)}const n=this.kt.map(t=>t.It());return this.Ut.export({worksheets:n,onProgress:this.U,fileName:t||this.j,hyperlinkXmlGenerator:this.Pt,hyperlinkRelsGenerator:this.Et,workSheetMaxRowsNum:this.Ct})}}t.ColConfigManagerLite=pt,t.ExcelKernel=bt,t.FulExcelExport=Mt,t.ImageManager=yt,t.MAX_ROWS_PER_SHEET=et,t.RowConfigManagerLite=vt,t.StreamExporter=Ct,t.StyleManager=ht,t.WorkSheet=Ft,t.buildMergeCellsXml=_t,t.buildRowStartTag=lt,t.buildSimpleStyleRpr=dt,t.colCache=nt,t.collectHyperlink=function(){return null},t.colorToArgbXml=ot,t.containsHtml=ct,t.createColConfig=function(){return new pt},t.createImageManager=function(){return new yt},t.createKernel=function(){return new bt},t.createRowConfig=function(){return new vt},t.createStreamExporter=Tt,t.default=Mt,t.escapeXml=rt,t.exportExcel=async function(t,e,n,r,i="export.xlsx",s=null,o=null,l=null){const h=new bt;let a;return o?a=o:n&&"object"==typeof n&&!Array.isArray(n)?a=n:(a=new pt,Array.isArray(n)),h.export({dataSource:t,mergeArr:e,onProgress:r,fileName:i,rowConfig:s||new vt,colConfig:a,imageManager:l||new yt})},t.generateHyperlinkRels=function(){return""},t.generateHyperlinksXml=function(){return""},t.getMemoryInfo=it,t.hasSimpleStyle=ft,t.hyperlinkPlugin={name:"hyperlink"},t.imagePlugin={name:"image"},t.mergePlugin={name:"merge"},t.normalizeColor=st,t.parseHTML=at,t.richtextPlugin=mt,t.rowcolPlugin={name:"rowcol"},t.stylePlugin={name:"style"},Object.defineProperty(t,"Xt",{value:!0})});
